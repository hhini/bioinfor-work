## 1.æ•°æ®å¤„ç†ï¼š

-   é€Ÿè§ˆè¡¨1ï¼Œå±•ç°è¡Œæ•°åˆ—æ•°ï¼Œåˆ—åï¼Œæ•°æ®ç±»å‹ç­‰ã€‚

-   ä½¿ç”¨ç­›é€‰ä¸€ä¸ªBRCA1_truncatingåˆ—ä¸ºâ€œYesâ€ï¼Œä¸”â€œBRCA2_truncatingåˆ—ä¸ºâ€œYesâ€ï¼Œä¸”relativeåˆ—ä¸º"Full Sibling"æˆ–"Child"çš„æ•°æ®äºšé›†ã€‚ä¹‹åé€‰æ‹©relative, B_year_Relatives, BRCA1_truncatingå’ŒBRCA2_truncatingå››åˆ—

-   å°†äºšé›†æ ¹æ®B_year_Relativesåˆ—é™åºé‡æ’ã€‚

-   åˆ›å»ºæ–°åˆ—cancerï¼šå½“First_Invasive_ICD7_1_Relativesåˆ—ä¸ºâ€œ170â€æ—¶ï¼Œå€¼ä¸ºâ€œBreast cancerâ€ï¼Œå…¶ä»–å€¼ä¸ºâ€œOther cancerâ€ï¼ŒNAæ—¶ä¸ºâ€œNo cancerâ€.

-   æŒ‰äº²å±ç±»å‹relativeåˆ—åˆ†ç»„ï¼Œè®¡ç®—æ¯ç»„çš„å¹³å‡PRS_Cambridgeåˆ†æ•°å’Œæœ‰ä¹³è…ºç™Œè¯Šæ–­çš„æ•°é‡ã€‚

### æ•°æ®å¤„ç†

```r
# åŠ è½½å¿…è¦åŒ…
library(readr)
library(dplyr)
library(stringr)

# 1) è¯»å–æ•°æ®
path <- "E:/acode/homwwork/data3/è¡¨1.txt"

# å¦‚æœæ˜¯åˆ¶è¡¨ç¬¦åˆ†éš”ï¼šdelim="\t"; å¦‚æœæ˜¯é€—å·åˆ†éš”ï¼Œå¯æ”¹ä¸º read_csv(path)
df <- read_delim(path, delim = "\t", locale = locale(encoding = "UTF-8"))

# é€Ÿè§ˆï¼šè¡Œæ•°ã€åˆ—æ•°ã€åˆ—åã€ç±»å‹
dim(df)         # è¡Œæ•°ã€åˆ—æ•°
names(df)       # åˆ—å
str(df)         # æ•°æ®ç±»å‹
glimpse(df)     # æ›´ç´§å‡‘çš„ç±»å‹ä¸å‰å‡ è¡Œ
```

å¾—åˆ°

``` r
1] 1000   44
 [1] "LopNr_relative"                 
 [2] "studieid_woman"                 
 [3] "Sex_Relatives"                  
 [4] "Birthdate_Relatives"            
 [5] "Birthcountry_Relatives"         
 [6] "last_migration_date_Relatives"  
 [7] "last_migrationstatus_Relatives" 
 [8] "relative"                       
 [9] "B_year_Relatives"               
[10] "x_agebase_woman"                
[11] "x_BC"                           
[12] "ATM_truncating"                 
[13] "BARD1_truncating"               
[14] "BRCA1_truncating"               
[15] "BRCA2_truncating"               
[16] "CHEK2_truncating"               
[17] "PALB2_truncating"               
[18] "RAD51C_truncating"              
[19] "RAD51D_truncating"              
[20] "TP53_truncating"                
[21] "RareVariants_31genes"           
[22] "RareVariants_pinkgenes"         
[23] "RareVariants_BRCA"              
[24] "RareVariants_nonBRCA"           
[25] "RareVariants_nonBRCA_pinkgenes" 
[26] "RareVariants_5genes"            
[27] "RareVariants_nonpink_genes"     
[28] "age_case_control_women"         
[29] "age_entry_Relatives"            
[30] "DODSDAT_Relatives"              
[31] "ICD_Death_Relatives"            
[32] "ULORSAK_Death_Relatives"        
[33] "DIADAT_Relatives"               
[34] "First_Invasive_ICD7_1_Relatives"
[35] "First_Invasive_ICD7_2_Relatives"
[36] "First_Invasive_ICD7_3_Relatives"
[37] "dataset"                        
[38] "PRS_Cambridge"                  
[39] "last_Cancerregister"            
[40] "last_FU"                        
[41] "age_exit_Relatives"             
[42] "Population"                     
[43] "Birthyear_cat_Relative"         
[44] "PRS_batch"                      
spc_tbl_ [1,000 Ã— 44] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ LopNr_relative                 : num [1:1000] 208702 150158 350011 263109 144609 ...
 $ studieid_woman                 : num [1:1000] 1429737 1177898 1242478 1656370 2533917 ...
 $ Sex_Relatives                  : num [1:1000] 2 2 1 1 2 2 2 1 1 1 ...
 $ Birthdate_Relatives            : Date[1:1000], format: "1954-07-15" ...
 $ Birthcountry_Relatives         : chr [1:1000] "Sverige" "Sverige" "Sverige" "Sverige" ...
 $ last_migration_date_Relatives  : Date[1:1000], format: NA ...
 $ last_migrationstatus_Relatives : chr [1:1000] NA NA "Inv" NA ...
 $ relative                       : chr [1:1000] "Full Sibling" "Child" "Child" "Full Sibling" ...
 $ B_year_Relatives               : num [1:1000] 1954 1980 1990 1950 1958 ...
 $ x_agebase_woman                : num [1:1000] 54 59 45 54 50 65 53 52 45 46 ...
 $ x_BC                           : num [1:1000] 0 0 0 0 0 0 0 1 0 0 ...
 $ ATM_truncating                 : chr [1:1000] NA NA NA NA ...
 $ BARD1_truncating               : chr [1:1000] NA NA NA NA ...
 $ BRCA1_truncating               : chr [1:1000] NA NA NA NA ...
 $ BRCA2_truncating               : chr [1:1000] NA NA NA NA ...
 $ CHEK2_truncating               : chr [1:1000] NA NA NA NA ...
 $ PALB2_truncating               : chr [1:1000] NA NA NA NA ...
 $ RAD51C_truncating              : chr [1:1000] NA NA NA NA ...
 $ RAD51D_truncating              : chr [1:1000] NA NA NA NA ...
 $ TP53_truncating                : chr [1:1000] NA NA NA NA ...
 $ RareVariants_31genes           : chr [1:1000] NA NA NA NA ...
 $ RareVariants_pinkgenes         : chr [1:1000] NA NA NA NA ...
 $ RareVariants_BRCA              : chr [1:1000] NA NA NA NA ...
 $ RareVariants_nonBRCA           : chr [1:1000] NA NA NA NA ...
 $ RareVariants_nonBRCA_pinkgenes : chr [1:1000] NA NA NA NA ...
 $ RareVariants_5genes            : chr [1:1000] NA NA NA NA ...
 $ RareVariants_nonpink_genes     : chr [1:1000] NA NA NA NA ...
 $ age_case_control_women         : num [1:1000] 61 66 51 61 57 ...
 $ age_entry_Relatives            : num [1:1000] 3.5 0 0 7.5 0 ...
 $ DODSDAT_Relatives              : Date[1:1000], format: "2015-01-21" ...
 $ ICD_Death_Relatives            : num [1:1000] 10 NA NA NA NA NA NA NA NA NA ...
 $ ULORSAK_Death_Relatives        : chr [1:1000] "C509" NA NA NA ...
 $ DIADAT_Relatives               : Date[1:1000], format: "2001-12-05" ...
 $ First_Invasive_ICD7_1_Relatives: num [1:1000] 170 NA NA NA NA NA NA NA NA NA ...
 $ First_Invasive_ICD7_2_Relatives: num [1:1000] NA NA NA NA NA NA NA NA NA NA ...
 $ First_Invasive_ICD7_3_Relatives: logi [1:1000] NA NA NA NA NA NA ...
 $ dataset                        : chr [1:1000] "KARMA" "KARMA" "KARMA" "KARMA" ...
 $ PRS_Cambridge                  : num [1:1000] 1.041 NA -0.751 NA NA ...
 $ last_Cancerregister            : Date[1:1000], format: "2017-12-29" ...
 $ last_FU                        : Date[1:1000], format: "2001-12-05" ...
 $ age_exit_Relatives             : num [1:1000] 47.4 37.8 27.6 67.5 59.5 ...
 $ Population                     : chr [1:1000] "Yes" "Yes" "Yes" "Yes" ...
 $ Birthyear_cat_Relative         : num [1:1000] 9 12 13 9 9 11 9 9 7 10 ...
 $ PRS_batch                      : chr [1:1000] "Oncoarray_new" NA "Oncoarray_new" NA ...
```

### ç¬¬äºŒæ­¥

```r
# 2) ç­›é€‰ BRCA1_truncating == "Yes" ä¸” BRCA2_truncating == "Yes"
#    åŒæ—¶ relative åœ¨ Full Sibling æˆ– Childï¼Œç„¶åé€‰æ‹©å››åˆ—
sub_df <- df %>%
  filter(
    BRCA1_truncating == "Yes",
    BRCA2_truncating == "Yes",
    relative %in% c("Full Sibling", "Child")
  ) %>%
  select(relative, B_year_Relatives, BRCA1_truncating, BRCA2_truncating)
```

### ç¬¬ä¸‰æ­¥

```r

# 3) æ ¹æ® B_year_Relatives é™åºé‡æ’
sub_df <- sub_df %>%
  arrange(desc(B_year_Relatives))
```

### ç¬¬å››æ­¥

```r
# 4) åˆ›å»ºæ–°åˆ— cancerï¼š
# First_Invasive_ICD7_1_Relatives == "170" â†’ "Breast cancer"
# å…¶å®ƒå€¼ â†’ "Other cancer"
# NA â†’ "No cancer"
df <- df %>%
  mutate(
    cancer = case_when(
      is.na(First_Invasive_ICD7_1_Relatives) ~ "No cancer",
      First_Invasive_ICD7_1_Relatives == "170" ~ "Breast cancer",
      TRUE ~ "Other cancer"
    )
  )

```

æœ€å

```r
# 5) æŒ‰äº²å±ç±»å‹åˆ†ç»„ï¼Œè®¡ç®—å¹³å‡ PRS_Cambridge å’Œä¹³è…ºç™Œè¯Šæ–­æ•°é‡
# ä¹³è…ºç™Œè¯Šæ–­æ•°é‡ï¼šcancer == "Breast cancer" çš„ä¸ªæ•°
summary_by_relative <- df %>%
  group_by(relative) %>%
  summarise(
    mean_PRS_Cambridge = mean(PRS_Cambridge, na.rm = TRUE),
    n_breast_cancer = sum(cancer == "Breast cancer", na.rm = TRUE),
    n = n()
  ) %>%
  ungroup()

# æŸ¥çœ‹ç»“æœ
print(sub_df)
print(summary_by_relative)
```

å¾—åˆ°Â·

``` r
+ # æŸ¥çœ‹ç»“æœ
+ print(sub_df)
+ print(summary_by_relative)
# A tibble: 0 Ã— 4
# â„¹ 4 variables: relative <chr>, B_year_Relatives <dbl>,
#   BRCA1_truncating <chr>, BRCA2_truncating <chr>
# A tibble: 4 Ã— 4
  relative     mean_PRS_Cambridge n_breast_cancer     n
  <chr>                     <dbl>           <int> <int>
1 Child                    -0.296               3   317
2 Father                   -0.414               0   202
3 Full Sibling             -0.211               8   293
4 Mother                   -0.277              24   188
```

## ğŸ” æ•°æ®å¤„ç†éƒ¨åˆ†ç»“æœè§£è¯»

### `sub_df` ä¸ºç©º

```         
# A tibble: 0 Ã— 4 
```

-   è¯´æ˜ï¼šåœ¨åŸå§‹æ•°æ®ä¸­ï¼Œæ²¡æœ‰ä»»ä½•è¡ŒåŒæ—¶æ»¡è¶³ï¼š

    -   `BRCA1_truncating == "Yes"`

    -   `BRCA2_truncating == "Yes"`

    -   `relative %in% c("Full Sibling", "Child")`

-   æ‰€ä»¥ç­›é€‰ç»“æœä¸ºç©ºè¡¨ã€‚è¿™å¹¶ä¸æ˜¯é”™è¯¯ï¼Œè€Œæ˜¯æ¡ä»¶è¿‡äºä¸¥æ ¼å¯¼è‡´æ²¡æœ‰åŒ¹é…ã€‚

### `summary_by_relative`

```         
# A tibble: 4 Ã— 4
  relative     mean_PRS_Cambridge n_breast_cancer     n
1 Child                    -0.296               3   317
2 Father                   -0.414               0   202
3 Full Sibling             -0.211               8   293
4 Mother                   -0.277              24   188
```

-   **å¹³å‡ PRS_Cambridge åˆ†æ•°**ï¼šä¸åŒäº²å±ç±»å‹çš„å¹³å‡å€¼éƒ½ä¸ºè´Ÿï¼Œè¯´æ˜æ•´ä½“é£é™©è¯„åˆ†åä½ã€‚

-   **ä¹³è…ºç™Œè¯Šæ–­æ•°é‡**ï¼š

    -   æ¯äº²ï¼ˆMotherï¼‰æœ‰ 24 ä¾‹ï¼Œæ˜¯æœ€å¤šçš„ã€‚

    -   å­å¥³ï¼ˆChildï¼‰æœ‰ 3 ä¾‹ã€‚

    -   å…¨åŒèƒï¼ˆFull Siblingï¼‰æœ‰ 8 ä¾‹ã€‚

    -   çˆ¶äº²ï¼ˆFatherï¼‰ä¸º 0ã€‚

-   **æ ·æœ¬é‡ n**ï¼šæ¯äº²å’Œçˆ¶äº²æ ·æœ¬é‡è¾ƒå°‘ï¼ˆ188ã€202ï¼‰ï¼Œå­å¥³å’ŒåŒèƒè¾ƒå¤šï¼ˆ317ã€293ï¼‰ã€‚

ğŸ‘‰ è§£è¯»ï¼šæ¯äº²ç¾¤ä½“åœ¨æ ·æœ¬ä¸­ä¹³è…ºç™Œè¯Šæ–­æ•°æœ€å¤šï¼Œå¹³å‡ PRS åˆ†æ•°ä¹Ÿç•¥ä½äºåŒèƒå’Œå­å¥³ã€‚çˆ¶äº²ç»„æ²¡æœ‰ä¹³è…ºç™Œç—…ä¾‹ã€‚

------------------------------------------------------------------------

## ç”Ÿå­˜åˆ†æï¼ˆbiostat3::melanomaï¼Œ10å¹´éšè®¿ä¸ Cox å›å½’ï¼‰

#### æ•°æ®ä¸æˆªæ­¢æ—¶é—´è®¾å®šï¼ˆ10 å¹´ = 120 ä¸ªæœˆï¼‰

çœ‹çœ‹æ•°æ®å•¥æ ·

```r
> head(melanoma)
     sex age     stage mmdx yydx surv_mm surv_yy       status          subsite
1 Female  81 Localised    2 1981    26.5     2.5  Dead: other    Head and Neck
2 Female  75 Localised    9 1975    55.5     4.5  Dead: other    Head and Neck
3 Female  78 Localised    2 1978   177.5    14.5  Dead: other            Limbs
4 Female  75   Unknown    8 1975    29.5     2.5 Dead: cancer Multiple and NOS
5 Female  81   Unknown    7 1981    57.5     4.5  Dead: other    Head and Neck
6 Female  75 Localised    9 1975    19.5     1.5 Dead: cancer            Trunk
         year8594         dx       exit agegrp id      ydx    yexit
1 Diagnosed 75-84 1981-02-02 1983-04-20    75+  1 1981.088 1983.298
2 Diagnosed 75-84 1975-09-21 1980-05-07    75+  2 1975.720 1980.348
3 Diagnosed 75-84 1978-02-21 1992-12-07    75+  3 1978.140 1992.934
4 Diagnosed 75-84 1975-08-25 1978-02-08    75+  4 1975.646 1978.104
5 Diagnosed 75-84 1981-07-09 1986-04-25    75+  5 1981.517 1986.312
6 Diagnosed 75-84 1975-09-03 1977-04-19    75+  6 1975.671 1977.296
```

```r
library(biostat3)
library(survival)
library(dplyr)

data("melanoma")

melanoma10 <- melanoma %>%
  mutate(
    surv_mm_10y = pmin(surv_mm, 120),
    status_10y = case_when(
      surv_mm <= 120 & status %in% c("Dead: cancer", "Dead: other","Lost to follow-up") ~ 1,
      TRUE ~ 0
    )
  )

```

#### ç ”ç©¶äººç¾¤ä¸è‡ªå˜é‡æ„é€ 

-   ç ”ç©¶äººç¾¤ï¼šå±€éƒ¨æœŸé»‘è‰²ç´ ç˜¤ï¼ˆstage = "Localised"ï¼‰ã€‚

-   è‡ªå˜é‡ï¼š

    -   æ€§åˆ«ï¼šsexï¼ˆå»ºè®®è½¬ä¸ºå› å­ï¼‰

    -   è¯Šæ–­å¹´ä»½ï¼š1985â€“1994 vs å…¶ä»–ï¼ˆåŸºäº yearï¼‰

    -   å¹´é¾„ç»„ï¼š\<45ã€45â€“59ã€60â€“74ã€75+

```r
mel_local <- melanoma10 %>%
  filter(stage == "Localised") %>%
  mutate(
    sex = factor(sex),
    year_grp = factor(year8594),   # ç›´æ¥ç”¨å·²æœ‰åˆ†ç»„
    age_grp = cut(
      age,
      breaks = c(-Inf, 45, 60, 75, Inf),
      labels = c("<45", "45-59", "60-74", "75+"),
      right = FALSE
    )
  )


```

#### æ„å»º Cox æ¨¡å‹å¹¶è¾“å‡ºç»“æœ

```r
# æ„å»º 10 å¹´ä»»ä½•åŸå› æ­»äº¡çš„ Cox æ¨¡å‹
cox_fit <- coxph(Surv(surv_mm_10y, status_10y) ~ sex + year_grp + age_grp, data = mel_local)

summary(cox_fit)
```

-   å…³æ³¨æ¯ä¸ªå˜é‡çš„é£é™©æ¯”ï¼ˆexp(coef)ï¼‰ã€95% CIã€p å€¼ã€‚é£é™©æ¯” \> 1 è¡¨ç¤ºç›¸å¯¹è¾ƒé«˜çš„æ­»äº¡é£é™©ï¼Œ\< 1 è¡¨ç¤ºè¾ƒä½é£é™©ã€‚è¯Šæ–­å¹´ä»½çš„â€œ1985â€“1994â€å¦‚æœ HR \< 1ï¼Œå¯èƒ½æš—ç¤ºè¯¥æ—¶æœŸçš„æ‚£è€…åœ¨10å¹´éšè®¿å†…æ€»ä½“æ­»äº¡é£é™©æ›´ä½ï¼Œéœ€ç»“åˆCIä¸på€¼åˆ¤æ–­ç»Ÿè®¡æ˜¾è‘—æ€§ã€‚å¹´é¾„ç»„é€šå¸¸éšå¹´é¾„å‡é«˜é£é™©ä¸Šå‡ï¼Œæ€§åˆ«æ•ˆåº”åˆ™éœ€çœ‹å…·ä½“ä¼°è®¡ä¸æ˜¾è‘—æ€§ã€‚

``` r
summary(cox_fit)
Call:
coxph(formula = Surv(surv_mm_10y, status_10y) ~ sex + year_grp + 
    age_grp, data = mel_local)

  n= 5318, number of events= 1586 

                            coef exp(coef) se(coef)      z Pr(>|z|)    
sexFemale               -0.49023   0.61248  0.05088 -9.635  < 2e-16 ***
year_grpDiagnosed 85-94 -0.29010   0.74819  0.05181 -5.599 2.15e-08 ***
age_grp45-59             0.38610   1.47122  0.08641  4.468 7.89e-06 ***
age_grp60-74             1.05923   2.88414  0.07925 13.365  < 2e-16 ***
age_grp75+               2.11580   8.29624  0.08205 25.788  < 2e-16 ***
---
Signif. codes:  0 â€˜***â€™ 0.001 â€˜**â€™ 0.01 â€˜*â€™ 0.05 â€˜.â€™ 0.1 â€˜ â€™ 1

                        exp(coef) exp(-coef) lower .95 upper .95
sexFemale                  0.6125     1.6327    0.5543    0.6767
year_grpDiagnosed 85-94    0.7482     1.3366    0.6759    0.8282
age_grp45-59               1.4712     0.6797    1.2420    1.7427
age_grp60-74               2.8841     0.3467    2.4692    3.3688
age_grp75+                 8.2962     0.1205    7.0639    9.7436

Concordance= 0.707  (se = 0.006 )
Likelihood ratio test= 887.4  on 5 df,   p=<2e-16
Wald test            = 937.8  on 5 df,   p=<2e-16
Score (logrank) test = 1121  on 5 df,   p=<2e-16
```

### ğŸ“Š Cox å›å½’ç»“æœè§£è¯»

å¾—åˆ°çš„ Cox æ¨¡å‹ç»“æœéå¸¸æ¸…æ™°ï¼š

-   **æ ·æœ¬é‡**ï¼š5318ï¼Œäº‹ä»¶æ•°ï¼ˆ10å¹´å†…æ­»äº¡ï¼‰= 1586

-   **æ€§åˆ«**ï¼šå¥³æ€§ HR = 0.61ï¼ˆ95% CI: 0.55â€“0.68ï¼‰ï¼Œæ˜¾è‘—ä½äºç”·æ€§ â†’ å¥³æ€§åœ¨å±€éƒ¨æœŸé»‘è‰²ç´ ç˜¤ä¸­ 10 å¹´æ­»äº¡é£é™©æ›´ä½ã€‚

-   **è¯Šæ–­å¹´ä»½**ï¼š1985â€“1994 HR = 0.75ï¼ˆ95% CI: 0.68â€“0.83ï¼‰ï¼Œæ˜¾è‘—ä½äºå…¶ä»–å¹´ä»½ â†’ è¯´æ˜è¯¥æ—¶æœŸæ‚£è€…çš„æ­»äº¡é£é™©è¾ƒä½ï¼Œå¯èƒ½åæ˜ è¯Šæ–­æˆ–æ²»ç–—æ”¹å–„ã€‚

-   **å¹´é¾„ç»„**ï¼š

    -   45â€“59 å² HR = 1.47

    -   60â€“74 å² HR = 2.88

    -   75+ å² HR = 8.30 â†’ é£é™©éšå¹´é¾„æ˜¾è‘—é€’å¢ï¼Œè¶‹åŠ¿éå¸¸æ˜æ˜¾ã€‚

**æ¨¡å‹æ•´ä½“æ‹Ÿåˆ**ï¼šConcordance = 0.707ï¼Œè¯´æ˜æ¨¡å‹åŒºåˆ†åº¦è‰¯å¥½ã€‚æ‰€æœ‰æ•´ä½“æ£€éªŒï¼ˆLRã€Waldã€Scoreï¼‰å‡é«˜åº¦æ˜¾è‘—ã€‚

åŸºäºå·²ç»æ„é€ å¥½çš„ `mel_local` æ•°æ®ï¼ˆåŒ…å« `surv_mm_10y` å’Œ `status_10y`ï¼‰ï¼š

```r
library(survival)
library(survminer)

# Kaplan-Meier ç”Ÿå­˜å¯¹è±¡
km_fit <- survfit(Surv(surv_mm_10y, status_10y) ~ age_grp, data = mel_local)

# ç»˜åˆ¶ç”Ÿå­˜æ›²çº¿
ggsurvplot(
  km_fit,
  data = mel_local,
  risk.table = TRUE,        # åœ¨å›¾ä¸‹æ–¹æ˜¾ç¤ºé£é™©è¡¨
  pval = TRUE,              # æ˜¾ç¤º log-rank æ£€éªŒ p å€¼
  conf.int = TRUE,          # æ˜¾ç¤ºç½®ä¿¡åŒºé—´
  legend.title = "å¹´é¾„ç»„",
  legend.labs = c("<45", "45-59", "60-74", "75+"),
  xlab = "éšè®¿æ—¶é—´ï¼ˆæœˆï¼‰",
  ylab = "ç”Ÿå­˜æ¦‚ç‡",
  title = "ä¸åŒå¹´é¾„ç»„çš„10å¹´ç”Ÿå­˜æ›²çº¿",
  palette = c("#1b9e77", "#d95f02", "#7570b3", "#e7298a") # è‡ªå®šä¹‰é…è‰²
)
 
```

### ğŸ“Œ è¯´æ˜

-   `Surv(surv_mm_10y, status_10y)`ï¼šä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„ 10 å¹´éšè®¿æ—¶é—´å’Œäº‹ä»¶æŒ‡æ ‡ã€‚

-   `~ age_grp`ï¼šè¿™é‡ŒæŒ‰å¹´é¾„ç»„åˆ†å±‚ç»˜åˆ¶æ›²çº¿ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¹æˆ `~ sex` æˆ– `~ year_grp`ã€‚

-   `risk.table = TRUE`ï¼šåœ¨å›¾ä¸‹æ–¹æ˜¾ç¤ºæ¯ä¸ªæ—¶é—´ç‚¹çš„é£é™©äººæ•°ã€‚

-   `pval = TRUE`ï¼šæ˜¾ç¤º log-rank æ£€éªŒçš„æ˜¾è‘—æ€§ã€‚

-   `conf.int = TRUE`ï¼šæ˜¾ç¤ºç½®ä¿¡åŒºé—´é˜´å½±ã€‚

![](plot-120.png)

#### ç­‰æ¯”ä¾‹é£é™©å‡è®¾æ£€éªŒï¼ˆPH å‡è®¾ï¼‰

```r
# Schoenfeld æ®‹å·®æ£€éªŒ
ph_test <- cox.zph(cox_fit)
print(ph_test)

# å¯è§†åŒ–ï¼ˆæŸ¥çœ‹æ¯ä¸ªåå˜é‡éšæ—¶é—´çš„æ®‹å·®è¶‹åŠ¿ï¼‰
par(mfrow = c(2, 2))
plot(ph_test)
par(mfrow = c(1, 1))
```

``` r
         chisq df    p
sex      1.595  1 0.21
year_grp 0.756  1 0.38
age_grp  0.856  3 0.84
GLOBAL   3.140  5 0.68
```

-   å¦‚æœæ•´ä½“æ£€éªŒæˆ–æŸä¸ªåå˜é‡çš„ p å€¼å°äº 0.05ï¼Œæç¤ºæ¯”ä¾‹é£é™©å‡è®¾å¯èƒ½ä¸æˆç«‹ã€‚

-   å›¾å½¢ä¸Šå¦‚æœæ®‹å·®æ‹Ÿåˆçº¿éšæ—¶é—´æ˜æ˜¾åç¦»æ°´å¹³çº¿ï¼ˆéé›¶æ–œç‡ï¼‰ï¼Œä¹Ÿæç¤º PH å‡è®¾è¿èƒŒã€‚

![](plot-119.png)

### âš–ï¸ ç­‰æ¯”ä¾‹é£é™©å‡è®¾æ£€éªŒ

Schoenfeld æ®‹å·®æ£€éªŒç»“æœï¼š

| å˜é‡       | Ï‡Â²    | df  | på€¼  |
|------------|-------|-----|------|
| sex        | 1.595 | 1   | 0.21 |
| year_grp   | 0.756 | 1   | 0.38 |
| age_grp    | 0.856 | 3   | 0.84 |
| **GLOBAL** | 3.140 | 5   | 0.68 |

-   æ‰€æœ‰ p å€¼ \> 0.05ï¼Œ**æ²¡æœ‰è¯æ®è¡¨æ˜æ¯”ä¾‹é£é™©å‡è®¾è¢«è¿å**ã€‚

-   è¯´æ˜ Cox æ¨¡å‹çš„å‡è®¾æˆç«‹ï¼Œå¯ä»¥ç›´æ¥è§£é‡Š HR ä¸ºæ’å®šçš„ç›¸å¯¹é£é™©ã€‚

------------------------------------------------------------------------

## åŸºå› å˜å¼‚çš„åŠŸèƒ½æ€§é¢„æµ‹

åœ¨[[https://www.kdocs.cn/l/caALpwLoJmmi]{.underline}](https://www.kdocs.cn/l/caALpwLoJmmi)è®¤é¢†åŸºå› ï¼Œå¹¶åœ¨gnomADä¸Šä¸‹è½½è¯¥åŸºå› æ•°æ®ï¼Œå®šä¹‰è¯¥åŸºå› çš„è‡´ç—…æ€§å˜å¼‚ï¼ˆå¤±èƒ½å˜å¼‚+åŠŸèƒ½æ€§é”™ä¹‰å˜å¼‚+ClinVarè‡´ç—…æ€§å˜å¼‚ï¼‰ã€‚é”™ä¹‰å˜å¼‚åŠŸèƒ½æ€§é¢„æµ‹ä½¿ç”¨SIFTï¼ŒPolyPhen 2 HVarï¼ŒMutationAssessorï¼ŒMetaSVM 100%é¢„æµ‹ç›¸åŒç»“æœã€‚

## CPN1 åŸºæœ¬æƒ…å†µ

-   CPN1 ç¼–ç çš„æ˜¯ â€œcarboxypeptidase N catalytic chainâ€ï¼ˆè¡€æµ†ç¾§è‚½é…¶ N çš„å‚¬åŒ–äºšåŸºï¼‰â€”â€”ä¸€ä¸ªé‡‘å±ä¾èµ–çš„ carboxypeptidaseã€‚

    åŠŸèƒ½ä¸Šï¼Œå®ƒè´Ÿè´£ä»è‚½ï¼è›‹ç™½è´¨çš„ C ç«¯åˆ‡é™¤ç¢±æ€§æ°¨åŸºé…¸ï¼ˆå¦‚ Lysï¼Argï¼‰ï¼Œå› æ­¤å¯¹è®¸å¤šè°ƒèŠ‚è‚½ï¼ˆæ¯”å¦‚æ¿€è‚½ã€anaphylatoxin ç­‰ï¼‰åœ¨è¡€æµ†ä¸­çš„ä»£è°¢ï¼å¤±æ´»å¾ˆé‡è¦ã€‚

    åœ¨ç”Ÿç‰©ä½“é‡Œï¼Œè¿™ä¸ªé…¶æ˜¯ä¸€ä¸ªå››èšä½“ï¼šä¸¤ä¸ªè°ƒèŠ‚ï¼ˆregulatoryï¼‰äºšåŸº + ä¸¤ä¸ªå‚¬åŒ–ï¼ˆcatalyticï¼Œä¹Ÿå°±æ˜¯ CPN1 ç¼–ç çš„ï¼‰äºšåŸºã€‚

    è¯¥åŸºå› åœ¨äººä½“åŸºå› ç»„ä¸­çš„ä½ç½®æ˜¯ **chr10q24.2**ï¼ˆGRCh38ï¼‰ ï¼Œå…±æœ‰ 9 ä¸ªå¤–æ˜¾å­ã€‚ [[å›½å®¶ç”Ÿç‰©æŠ€æœ¯ä¿¡æ¯ä¸­å¿ƒ]{.underline}](https://www.ncbi.nlm.nih.gov/gene?Cmd=DetailsSearch&Db=gene&Term=1369&utm_source=chatgpt.com){alt="https://www.ncbi.nlm.nih.gov/gene?Cmd=DetailsSearch&Db=gene&Term=1369&utm_source=chatgpt.com"}

    ä¸ä¹‹ç›¸å…³çš„ç–¾ç—…åŒ…æ‹¬ Carboxypeptidase N deficiencyï¼Œä¸€ç§å¸¸è§ä¸ºå¸¸æŸ“è‰²ä½“éšæ€§ (AR) çš„ç–¾ç—…ï¼›è¡¨ç°å¯èƒ½ä¸ºè¡€æµ† CPN æ°´å¹³ä½ã€ä»¥åŠä¸è¡€æµ†æ´»æ€§è‚½ä»£è°¢å¼‚å¸¸ç›¸å…³çš„ä¸´åºŠç—‡çŠ¶ï¼ˆå¦‚åå¤å‘ä½œçš„è¡€ç®¡æ€§æ°´è‚¿æˆ–æ…¢æ€§è¨éº»ç–¹ï¼è¿‡æ•æ€§ååº”ï¼‰ç­‰ã€‚

```{python}
import pandas as pd

# è¯»å– gnomAD CSV
df = pd.read_csv(r"E:\acode\homwwork\data\gnomAD_v4.1.0_ENSG00000120054_2025_12_03_15_08_57.csv")
```

æŸ¥çœ‹æ•°æ®å¹¶ä¸”è½¬æ¢æˆ‘ä»¬éœ€è¦çš„æ ¼å¼

```{python}
print(df.head())
print(df.columns)
```

``` python
df = pd.read_csv(r"E:\acode\homwwork\data\gnomAD_v4.1.0_ENSG00000120054_2025_12_03_15_08_57.csv")
>>> print(df.head())
... print(df.columns)
           gnomAD ID  ...  Hemizygote Count Remaining
0   10-100042357-G-C  ...                           0
1   10-100042358-A-G  ...                           0
2   10-100042360-A-C  ...                           0
3  10-100042361-GA-G  ...                           0
4   10-100042363-A-T  ...                           0

[5 rows x 72 columns]
Index(['gnomAD ID', 'Chromosome', 'Position', 'rsIDs', 'Reference', 'Alternate',
       'Source', 'Filters - exomes', 'Filters - genomes', 'Transcript',
       'HGVS Consequence', 'Protein Consequence', 'Transcript Consequence',
       'VEP Annotation', 'ClinVar Germline Classification',
       'ClinVar Variation ID', 'Flags', 'Allele Count', 'Allele Number',
       'Allele Frequency', 'Homozygote Count', 'Hemizygote Count',
       'Filters - joint', 'GroupMax FAF group', 'GroupMax FAF frequency',
       'cadd', 'revel_max', 'spliceai_ds_max', 'pangolin_largest_ds', 'phylop',
       'sift_max', 'polyphen_max', 'Allele Count African/African American',
       'Allele Number African/African American',
       'Homozygote Count African/African American',
       'Hemizygote Count African/African American',
       'Allele Count Admixed American', 'Allele Number Admixed American',
       'Homozygote Count Admixed American', 'Hemizygote Count Admixed American',
       'Allele Count Ashkenazi Jewish', 'Allele Number Ashkenazi Jewish',
       'Homozygote Count Ashkenazi Jewish', 'Hemizygote Count Ashkenazi Jewish',
       'Allele Count East Asian', 'Allele Number East Asian',
       'Homozygote Count East Asian', 'Hemizygote Count East Asian',
       'Allele Count European (Finnish)', 'Allele Number European (Finnish)',
       'Homozygote Count European (Finnish)',
       'Hemizygote Count European (Finnish)', 'Allele Count Middle Eastern',
       'Allele Number Middle Eastern', 'Homozygote Count Middle Eastern',
       'Hemizygote Count Middle Eastern', 'Allele Count European (non-Finnish)',
       'Allele Number European (non-Finnish)',
       'Homozygote Count European (non-Finnish)',
       'Hemizygote Count European (non-Finnish)', 'Allele Count Amish',
       'Allele Number Amish', 'Homozygote Count Amish',
       'Hemizygote Count Amish', 'Allele Count South Asian',
       'Allele Number South Asian', 'Homozygote Count South Asian',
       'Hemizygote Count South Asian', 'Allele Count Remaining',
       'Allele Number Remaining', 'Homozygote Count Remaining',
       'Hemizygote Count Remaining'],
      dtype='object')
```

å°† gnomAD çš„ CSV æ–‡ä»¶è½¬æ¢ä¸º ANNOVAR æ‰€éœ€çš„ `.avinput` æ ¼å¼ï¼Œéœ€è¦æå–ä»¥ä¸‹äº”åˆ—å¹¶è¿›è¡Œé€‚å½“å¤„ç†ï¼š

-   `Chromosome` â†’ è½¬æ¢ä¸º `chr` æ ¼å¼ï¼ˆä¾‹å¦‚ `21` â†’ `chr5`ï¼‰

-   `Position` â†’ ç”¨ä½œ `start` å’Œ `end`ï¼ˆå•æ ¸è‹·é…¸å˜å¼‚ï¼‰

-   `Reference` â†’ åŸå§‹ç¢±åŸº

-   `Alternate` â†’ æ›¿ä»£ç¢±åŸº

### âœ… ç¤ºä¾‹ Python è„šæœ¬ï¼ˆé€‚ç”¨äº SNV å’Œç®€å• indelï¼‰

```{python}
import pandas as pd

# è¯»å– CSV æ–‡ä»¶
df = pd.read_csv(r"E:\acode\homwwork\data\gnomAD_v4.1.0_ENSG00000120054_2025_12_03_15_08_57.csv")

# æ„å»º ANNOVAR æ‰€éœ€åˆ—
def format_chr(chrom):
    return f"chr{chrom}"

def get_end(pos, ref):
    return pos + len(ref) - 1

annovar_df = pd.DataFrame({
    'chr': df['Chromosome'].apply(format_chr),
    'start': df['Position'],
    'end': df.apply(lambda row: get_end(row['Position'], str(row['Reference'])), axis=1),
    'ref': df['Reference'],
    'alt': df['Alternate']
})

# ä¿å­˜ä¸º .avinput æ–‡ä»¶
annovar_df.to_csv(r"E:\acode\homwwork\data\gnomAD_CPN1.avinput", sep='\t', index=False, header=False)
```

å¾—åˆ°

``` python
>>> print(annovar_df.head)
<bound method NDFrame.head of         chr      start        end ref alt
0     chr10  100042357  100042357   G   C
1     chr10  100042358  100042358   A   G
2     chr10  100042360  100042360   A   C
3     chr10  100042361  100042362  GA   G
4     chr10  100042363  100042363   A   T
...     ...        ...        ...  ..  ..
1832  chr10  100081694  100081694   C   T
1833  chr10  100081696  100081696   C   G
1834  chr10  100081696  100081696   C   T
1835  chr10  100081697  100081697   G   T
1836  chr10  100081697  100081697   G   A

[1837 rows x 5 columns]>

### âœ… ä¸‹è½½ä¸å‡†å¤‡æ•°æ®åº“ï¼šå¿«é€Ÿæ£€æŸ¥æ¸…å•

| æ•°æ®åº“ | æ–‡ä»¶æ•°é‡ | æ˜¯å¦å¿…é¡» | ç”¨é€” |
|------------------|------------------|------------------|------------------|
| **dbNSFP v4.2a** | 2ï¼ˆä¸»æ–‡ä»¶ + ç´¢å¼•ï¼‰ | âœ… | æä¾›å¤šä¸ªåŠŸèƒ½é¢„æµ‹å·¥å…·ï¼ˆSIFTã€PolyPhen2ã€MetaSVMç­‰ï¼‰ |
| **ClinVar 20240611** | 2ï¼ˆä¸»æ–‡ä»¶ + ç´¢å¼•ï¼‰ | âœ… | è‡´ç—…æ€§æ³¨é‡Šï¼Œç”¨äºç­›é€‰ä¸´åºŠç›¸å…³å˜å¼‚ |
| **refGene** | 3ï¼ˆæ³¨é‡Š + mRNA + ç‰ˆæœ¬ï¼‰ | âœ… | åŸºå› ç»“æ„æ³¨é‡Šï¼Œç”¨äºå®šä½å˜å¼‚ä½ç½® |

### ğŸ§  å®ç”¨å»ºè®®ä¸æ³¨æ„äº‹é¡¹

#### 1. **æ–‡ä»¶è·¯å¾„ä¸æƒé™**

-   ç¡®ä¿ `humandb/` ç›®å½•æœ‰å†™æƒé™ï¼Œé¿å… `annotate_variation.pl` ä¸‹è½½å¤±è´¥ã€‚

-   ä¸‹è½½åä½¿ç”¨ `ls -lh` æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦å®Œæ•´ï¼ˆå¦‚ dbNSFP åº”çº¦ 40GBï¼‰ã€‚

#### 2. **è§£å‹é¡ºåºä¸å‘½ä»¤**

#### 3. **ç‰ˆæœ¬åŒ¹é…**

-   ç¡®ä¿æˆ‘ä»¬çš„ ANNOVAR æ˜¯æœ€æ–°ç‰ˆï¼Œæ”¯æŒ `dbnsfp42a` å’Œ `clinvar_20240611`ã€‚

-   å¯è¿è¡Œ `./annotate_variation.pl -version` æ£€æŸ¥ç‰ˆæœ¬ã€‚

## æ³¨é‡Š

### âœ… ANNOVAR æ³¨é‡Šå‘½ä»¤

``` bash
perl /mnt/e/acode/homwwork/data/annovar.latest/annovar/table_annovar.pl \
  /mnt/e/acode/homwwork/data/gnomAD_CPN1.avinput \
  /mnt/e/acode/homwwork/data/annovar.latest/annovar/humandb/ \
  -buildver hg38 \
  -out /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno \
  -remove \
  -protocol refGene,dbnsfp42a,clinvar_20240611 \
  -operation g,f,f \
  -nastring . \
  -polish \
  -xref /mnt/e/acode/homwwork/data/annovar.latest/annovar/example/gene_fullxref.txt
```

``` bash
jayz@localhost:/mnt/e/acode/homwwork$ perl /mnt/e/acode/homwwork/data/annovar.latest/annovar/table_annovar.pl \
  /mnt/e/acode/homwwork/data/gnomAD_CPN1.avinput \
  /mnt/e/acode/homwwork/data/annovar.latest/annovar/humandb/ \    
  -buildver hg38 \
  -out /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno \
  -remove \
  -protocol refGene,dbnsfp42a,clinvar_20240611 \
  -operation g,f,f \
  -nastring . \
  -polish \
  -xref /mnt/e/acode/homwwork/data/annovar.latest/annovar/example/gene_fullxref.txt
-----------------------------------------------------------------
NOTICE: Processing operation=g protocol=refGene

NOTICE: Running with system command <annotate_variation.pl -geneanno -buildver hg38 -dbtype refGene -outfile /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno.refGene -exonsort -nofirstcodondel /mnt/e/acode/homwwork/data/gnomAD_CPN1.avinput /mnt/e/acode/homwwork/data/annovar.latest/annovar/humandb/>
NOTICE: Output files are written to /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno.refGene.variant_function, /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno.refGene.exonic_variant_function
NOTICE: Reading gene annotation from /mnt/e/acode/homwwork/data/annovar.latest/annovar/humandb/hg38_refGene.txt ... Done with 88819 transcripts (including 21511 without coding sequence annotation) for 28307 unique genes
NOTICE: Processing next batch with 1837 unique variants in 1837 input lines
NOTICE: Reading FASTA sequences from /mnt/e/acode/homwwork/data/annovar.latest/annovar/humandb/hg38_refGeneMrna.fa ... Done with 1 sequences
WARNING: A total of 606 sequences will be ignored due to lack of correct ORF annotation

NOTICE: Running with system command <coding_change.pl  /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno.refGene.exonic_variant_function.orig /mnt/e/acode/homwwork/data/annovar.latest/annovar/humandb//hg38_refGene.txt /mnt/e/acode/homwwork/data/annovar.latest/annovar/humandb//hg38_refGeneMrna.fa -alltranscript -out /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno.refGene.fa -newevf /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno.refGene.exonic_variant_function>
-----------------------------------------------------------------
NOTICE: Processing operation=f protocol=dbnsfp42a
NOTICE: Finished reading 107 column headers for '-dbtype dbnsfp42a'

NOTICE: Running system command <annotate_variation.pl -filter -dbtype dbnsfp42a -buildver hg38 -outfile /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno /mnt/e/acode/homwwork/data/gnomAD_CPN1.avinput /mnt/e/acode/homwwork/data/annovar.latest/annovar/humandb/ -otherinfo>
NOTICE: Output file with variants matching filtering criteria is written to /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno.hg38_dbnsfp42a_dropped, and output file with other variants is written to /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno.hg38_dbnsfp42a_filtered   
NOTICE: Processing next batch with 1837 unique variants in 1837 input lines
NOTICE: Database index loaded. Total number of bins is 556674 and the number of bins to be scanned is 21
NOTICE: Scanning filter database /mnt/e/acode/homwwork/data/annovar.latest/annovar/humandb/hg38_dbnsfp42a.txt...Done
-----------------------------------------------------------------
NOTICE: Processing operation=f protocol=clinvar_20240611
NOTICE: Finished reading 5 column headers for '-dbtype clinvar_20240611'

NOTICE: Running system command <annotate_variation.pl -filter -dbtype clinvar_20240611 -buildver hg38 -outfile /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno /mnt/e/acode/homwwork/data/gnomAD_CPN1.avinput /mnt/e/acode/homwwork/data/annovar.latest/annovar/humandb/ -otherinfo>
NOTICE: the --dbtype clinvar_20240611 is assumed to be in generic ANNOVAR database format
NOTICE: Output file with variants matching filtering criteria is written to /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno.hg38_clinvar_20240611_dropped, and output file with other variants is written to /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno.hg38_clinvar_20240611_filtered
NOTICE: Processing next batch with 1837 unique variants in 1837 input lines
NOTICE: Database index loaded. Total number of bins is 171655 and the number of bins to be scanned is 7
NOTICE: Scanning filter database /mnt/e/acode/homwwork/data/annovar.latest/annovar/humandb/hg38_clinvar_20240611.txt...Done
-----------------------------------------------------------------
NOTICE: Multianno output file is written to /mnt/e/acode/homwwork/data/gnomAD_CPN1_anno.hg38_multianno.txt
```

## ç»“æœåˆ†æä¸ç­›é€‰

åˆ—å

``` bash
head -n 1 gnomAD_CPN1_anno.hg38_multianno.txt | tr '\t' '\n' | nl
```

å¾—åˆ°

``` bash
jayz@localhost:/mnt/e/acode/homwwork/data$ head -n 1 gnomAD_CPN1_anno.hg38_multianno.txt | tr '\t' '\n' | nl
     1  Chr
     2  Start
     3  End
     4  Ref
     5  Alt
     6  Func.refGene
     7  Gene.refGene
     8  GeneDetail.refGene
     9  ExonicFunc.refGene
    10  AAChange.refGene
    11  SIFT_score
    12  SIFT_converted_rankscore
    13  SIFT_pred
    14  SIFT4G_score
    15  SIFT4G_converted_rankscore
    16  SIFT4G_pred
    17  Polyphen2_HDIV_score
    18  Polyphen2_HDIV_rankscore
    19  Polyphen2_HDIV_pred
    20  Polyphen2_HVAR_score
    21  Polyphen2_HVAR_rankscore
    22  Polyphen2_HVAR_pred
    23  LRT_score
    24  LRT_converted_rankscore
    25  LRT_pred
    26  MutationTaster_score
    27  MutationTaster_converted_rankscore
    28  MutationTaster_pred
    29  MutationAssessor_score
    30  MutationAssessor_rankscore
    31  MutationAssessor_pred
    32  FATHMM_score
    33  FATHMM_converted_rankscore
    34  FATHMM_pred
    35  PROVEAN_score
    36  PROVEAN_converted_rankscore
    37  PROVEAN_pred
    38  VEST4_score
    39  VEST4_rankscore
    40  MetaSVM_score
    41  MetaSVM_rankscore
    42  MetaSVM_pred
    43  MetaLR_score
    44  MetaLR_rankscore
    45  MetaLR_pred
    46  MetaRNN_score
    47  MetaRNN_rankscore
    48  MetaRNN_pred
    49  M-CAP_score
    50  M-CAP_rankscore
    51  M-CAP_pred
    52  REVEL_score
    53  REVEL_rankscore
    54  MutPred_score
    55  MutPred_rankscore
    56  MVP_score
    57  MVP_rankscore
    58  MPC_score
    59  MPC_rankscore
    60  PrimateAI_score
    61  PrimateAI_rankscore
    62  PrimateAI_pred
    63  DEOGEN2_score
    64  DEOGEN2_rankscore
    65  DEOGEN2_pred
    66  BayesDel_addAF_score
    67  BayesDel_addAF_rankscore
    68  BayesDel_addAF_pred
    69  BayesDel_noAF_score
    70  BayesDel_noAF_rankscore
    71  BayesDel_noAF_pred
    72  ClinPred_score
    73  ClinPred_rankscore
    74  ClinPred_pred
    75  LIST-S2_score
    76  LIST-S2_rankscore
    77  LIST-S2_pred
    78  Aloft_pred
    79  Aloft_Confidence
    80  CADD_raw
    81  CADD_raw_rankscore
    82  CADD_phred
    83  DANN_score
    84  DANN_rankscore
    85  fathmm-MKL_coding_score
    86  fathmm-MKL_coding_rankscore
    87  fathmm-MKL_coding_pred
    88  fathmm-XF_coding_score
    89  fathmm-XF_coding_rankscore
    90  fathmm-XF_coding_pred
    91  Eigen-raw_coding
    92  Eigen-raw_coding_rankscore
    93  Eigen-PC-raw_coding
    94  Eigen-PC-raw_coding_rankscore
    95  GenoCanyon_score
    96  GenoCanyon_rankscore
    97  integrated_fitCons_score
    98  integrated_fitCons_rankscore
    99  integrated_confidence_value
   100  LINSIGHT
   101  LINSIGHT_rankscore
   102  GERP++_NR
   103  GERP++_RS
   104  GERP++_RS_rankscore
   105  phyloP100way_vertebrate
   106  phyloP100way_vertebrate_rankscore
   107  phyloP30way_mammalian
   108  phyloP30way_mammalian_rankscore
   109  phastCons100way_vertebrate
   110  phastCons100way_vertebrate_rankscore
   111  phastCons30way_mammalian
   112  phastCons30way_mammalian_rankscore
   113  SiPhy_29way_logOdds
   114  SiPhy_29way_logOdds_rankscore
   115  Interpro_domain
   116  GTEx_V8_gene
   117  GTEx_V8_tissue
   118  CLNALLELEID
   119  CLNDN
   120  CLNDISDB
   121  CLNREVSTAT
   122  CLNSIG
```

### ğŸ§¬ LoF å˜å¼‚ç±»å‹è¯¦è§£ï¼ˆå­—æ®µï¼š`ExonicFunc.refGene`ï¼‰

| ç±»å‹ | è¯¦ç»†è¯´æ˜ |
|------------------------------------|------------------------------------|
| `stopgain` | åœ¨ç¼–ç åŒºå¼•å…¥ä¸€ä¸ª**æå‰ç»ˆæ­¢å¯†ç å­**ï¼ˆå¦‚ UAGã€UAAã€UGAï¼‰ï¼Œä½¿ç¿»è¯‘åœ¨ä¸­é€”åœæ­¢ï¼Œå¯¼è‡´è›‹ç™½è´¨**æˆªçŸ­**ã€‚è¿™ç§æˆªçŸ­å¯èƒ½ä½¿è›‹ç™½å¤±å»å…³é”®ç»“æ„åŸŸæˆ–åŠŸèƒ½ä½ç‚¹ï¼Œå¸¸è§äºè‡´ç—…çªå˜ã€‚ |
| `frameshift_deletion` | åˆ é™¤çš„ç¢±åŸºæ•°ä¸æ˜¯ 3 çš„å€æ•°ï¼Œå¯¼è‡´**é˜…è¯»æ¡†ç§»ä½**ã€‚ç§»ä½åçš„å¯†ç å­åºåˆ—å®Œå…¨æ”¹å˜ï¼Œé€šå¸¸ä¼šå¼•å…¥æå‰ç»ˆæ­¢å¯†ç å­ï¼Œç”Ÿæˆå¼‚å¸¸è›‹ç™½æˆ–è§¦å‘**NMDï¼ˆæ— ä¹‰ä»‹å¯¼çš„ mRNA é™è§£ï¼‰**ã€‚ |
| `frameshift_insertion` | æ’å…¥çš„ç¢±åŸºæ•°ä¸æ˜¯ 3 çš„å€æ•°ï¼ŒåŒæ ·å¯¼è‡´**é˜…è¯»æ¡†æ”¹å˜**ã€‚åç»­æ°¨åŸºé…¸åºåˆ—è¢«é‡å†™ï¼ŒåŠŸèƒ½ä¸§å¤±é£é™©æé«˜ã€‚ |
| `splicing` | å½±å“**å‰ªæ¥ä½ç‚¹**ï¼ˆå¦‚ GT-AG è¾¹ç•Œï¼‰ï¼Œå¯èƒ½å¯¼è‡´å¤–æ˜¾å­è·³è¿‡ã€é”™é…æˆ–å†…å«å­ä¿ç•™ã€‚ç»“æœå¯èƒ½æ˜¯**è›‹ç™½ç»“æ„å¼‚å¸¸**æˆ–åŠŸèƒ½åŸŸç¼ºå¤±ï¼Œå°¤å…¶å½“å‰ªæ¥é”™è¯¯å½±å“å…³é”®åŒºåŸŸæ—¶ã€‚ |
| `stoploss` | åˆ é™¤åŸæœ¬çš„**ç»ˆæ­¢å¯†ç å­**ï¼Œä½¿ç¿»è¯‘ç»§ç»­è¿›è¡Œï¼Œå¯¼è‡´è›‹ç™½**å»¶é•¿**ã€‚å»¶é•¿éƒ¨åˆ†å¯èƒ½å¹²æ‰°è›‹ç™½æŠ˜å ã€å®šä½æˆ–åŠŸèƒ½ï¼Œç”šè‡³å¼•å…¥æ¯’æ€§åºåˆ—ã€‚ |
| `startloss` | åˆ é™¤æˆ–çªå˜èµ·å§‹å¯†ç å­ï¼ˆé€šå¸¸æ˜¯ ATGï¼‰ï¼Œå¯èƒ½é˜»æ­¢ç¿»è¯‘å¯åŠ¨ã€‚è‹¥æ²¡æœ‰æ›¿ä»£èµ·å§‹ä½ç‚¹ï¼Œè›‹ç™½å°†**æ— æ³•è¡¨è¾¾**ï¼Œç›´æ¥å¯¼è‡´åŠŸèƒ½ç¼ºå¤±ã€‚ |

``` bash
awk -F'\t' '$9 ~ /stopgain|frameshift_deletion|frameshift_insertion|splicing|stoploss|startloss/' gnomAD_CPN1_anno.hg38_multianno.txt > CPN1_LOF.txt 
```

``` bash
jayz@localhost:/mnt/e/acode/homwwork/data$ head CPN1_LOF.txt
chr10   100042441       100042441       T       A       exonic  CPN1      .       stopgain        CPN1:NM_001308:exon9:c.A1363T:p.R455X     .       .       .       .       .       .       .       ...       .       .       .       .       .       1.000   0.207   N..       .       .       .       .       .       .       .       0.641     0.653   .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       0.343     0.860   D       0.254   0.858   D       .       .       ...       .       Recessive;      High;   5.625   0.949   34      0.915     0.207   0.028   0.076   N       0.072   0.143   N       -0.267    0.304   -0.615  0.191   0.981   0.303   0.554   0.289   0..       4.79    -0.415  0.117   -0.085  0.112   0.177   0.213   0.000     0.064   0.030   0.153   7.216   0.251   .       .       ...       .       .       .
chr10   100042465       100042465       C       A       exonic  CPN1      .       stopgain        CPN1:NM_001308:exon9:c.G1339T:p.E447X     .       .       .       .       .       .       .       ...       .       .       .       .       .       0.562   0.322   D..       .       .       .       .       .       .       .       0.492     0.526   .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       0.343     0.860   D       0.254   0.858   D       .       .       ...       .       Recessive;      High;   5.588   0.948   34      0.966     0.304   0.027   0.074   N       0.056   0.104   N       -0.173    0.343   -0.536  0.212   0.984   0.306   0.554   0.289   0..       4.02    1.14    0.198   0.063   0.143   0.129   0.186   0.000     0.064   0.003   0.082   3.341   0.067   .       .       ...       .       .       .
chr10   100042480       100042480       G       A       exonic  CPN1      .       stopgain        CPN1:NM_001308:exon9:c.C1324T:p.Q442X     .       .       .       .       .       .       .       ...       .       .       0.000   0.002   N       1.000   0.588   D..       .       .       .       .       .       .       .       0.515     0.546   .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       0.501     0.943   D       0.482   0.942   D       .       .       ...       .       Recessive;      High;   6.553   0.965   36      0.981     0.382   0.474   0.280   N       0.142   0.264   N       0.198     0.511   -0.050  0.375   1.000   0.412   0.554   0.289   0..       5.11    4.2     0.488   1.464   0.349   0.213   0.241   0.293     0.253   0.050   0.170   11.335  0.487   .       .       ...       .       .       .
chr10   100048833       100048833       G       T       exonic  CPN1      .       stopgain        CPN1:NM_001308:exon8:c.C1155A:p.Y385X     .       .       .       .       .       .       .       ...       .       .       0.000   0.843   D       1       0.810   A..       .       .       .       .       .       .       .       0.918     0.921   .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       0.380     0.887   D       0.308   0.886   D       .       .       ...       .       Recessive;.;    High;.; 7.559   0.980   38      0.985     0.422   0.893   0.496   D       0.080   0.163   N       0.084     0.457   -0.190  0.319   0.075   0.157   0.615   0.376   0..       5.5     0.427   0.157   3.602   0.538   0.216   0.242   1.000     0.716   0.912   0.384   9.160   0.362   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A       .       ...       .       .       .
chr10   100054405       100054405       G       T       exonic  CPN1      .       stopgain        CPN1:NM_001308:exon7:c.C1053A:p.Y351X     .       .       .       .       .       .       .       ...       .       .       0.599   0.110   N       1       0.810   A..       .       .       .       .       .       .       .       0.867     0.864   .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       0.283     0.816   D       0.169   0.814   D       .       .       ...       .       Recessive;.;    High;.; 5.061   0.934   33      0.963     0.293   0.055   0.113   N       0.103   0.207   N       -0.345    0.275   -0.797  0.146   0.993   0.331   0.554   0.289   0..       4.23    -8.02   0.010   0.136   0.158   -0.056  0.130   0.005     0.170   0.110   0.198   20.517  0.992   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A       .       ...       .       .       .
chr10   100054413       100054413       C       A       exonic  CPN1      .       stopgain        CPN1:NM_001308:exon7:c.G1045T:p.E349X     .       .       .       .       .       .       .       ...       .       .       0.000   0.629   D       1       0.810   A..       .       .       .       .       .       .       .       0.882     0.880   .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       0.575     0.968   D       0.588   0.968   D       .       .       ...       .       Recessive;.;    High;.; 7.980   0.987   40      0.996     0.747   0.864   0.457   D       0.402   0.476   N       0.660     0.770   0.482   0.668   0.753   0.234   0.487   0.140   0..       4.23    4.23    0.493   1.363   0.338   1.026   0.459   0.763     0.293   0.826   0.344   11.416  0.492   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A       .       ...       .       .       .
chr10   100057032       100057033       AG      A       exonic  CPN1      .       stopgain        CPN1:NM_001308:exon6:c.991_992delinsT:p.L331*     .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .
chr10   100057053       100057053       C       T       exonic  CPN1      .       stopgain        CPN1:NM_001308:exon6:c.G971A:p.W324X      .       .       .       .       .       .       .       ...       .       .       0.002   0.383   N       1       0.810   A..       .       .       .       .       .       .       .       0.908     0.909   .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       0.607     0.979   D       0.635   0.978   D       .       .       ...       .       Recessive;.;    High;.; 7.751   0.983   39      0.997     0.782   0.980   0.786   D       0.121   0.236   N       0.805     0.864   0.661   0.794   0.998   0.369   0.554   0.289   0..       4.46    4.46    0.536   4.964   0.634   1.026   0.459   1.000     0.716   0.999   0.704   17.300  0.871   Peptidase M14, carboxypeptidase A|Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A|Peptidase M14, carboxypeptidase A     .       ...       .       .       .
chr10   100057063       100057063       G       A       exonic  CPN1      .       stopgain        CPN1:NM_001308:exon6:c.C961T:p.Q321X      .       .       .       .       .       .       .       ...       .       .       0.339   0.140   N       1       0.810   A..       .       .       .       .       .       .       .       0.789     0.785   .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       0.240     0.777   D       0.288   0.876   D       .       .       ...       .       Recessive;.;    High;.; 7.004   0.971   37      0.994     0.634   0.676   0.335   D       0.181   0.308   N       0.550     0.701   0.288   0.548   0.172   0.178   0.487   0.140   0..       4.46    3.53    0.395   2.199   0.423   1.176   0.789   0.715     0.288   0.090   0.190   13.682  0.620   Peptidase M14, carboxypeptidase A|Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A|Peptidase M14, carboxypeptidase A     .       ...       .       .       .
chr10   100057138       100057138       T       TA      exonic  CPN1      .       stopgain        CPN1:NM_001308:exon6:c.886delinsTA:p.N296*        .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .       .       .       .       .       ...       .       .       .
```

-   è¿™æ˜¯åœ¨ gnomAD æ³¨é‡Šæ–‡ä»¶ä¸­ç­›é€‰ **å¤±èƒ½å˜å¼‚ï¼ˆLoss-of-function, LOFï¼‰**ã€‚

-   åŒ…æ‹¬ï¼š`stopgain`ï¼ˆæå‰ç»ˆæ­¢ï¼‰ã€`frameshift`ï¼ˆç§»ç ï¼‰ã€`splicing`ï¼ˆå‰ªæ¥ä½ç‚¹ï¼‰ã€`stoploss`ï¼ˆç»ˆæ­¢å¯†ç å­ä¸¢å¤±ï¼‰ã€`startloss`ï¼ˆèµ·å§‹å¯†ç å­ä¸¢å¤±ï¼‰ã€‚

-   è¾“å‡ºæ–‡ä»¶å°±æ˜¯ **CPN1 åŸºå› çš„ LOF å˜å¼‚é›†åˆ**ã€‚

## 1. æ–‡ä»¶å†…å®¹ç»“æ„

æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªå˜å¼‚ï¼Œä¸»è¦å­—æ®µï¼š

-   **chr10 / åæ ‡**ï¼šå˜å¼‚æ‰€åœ¨æŸ“è‰²ä½“å’Œä½ç½®ã€‚

-   **REF/ALT**ï¼šå‚è€ƒå’Œæ›¿ä»£ç¢±åŸºã€‚

-   **åŠŸèƒ½æ³¨é‡Š**ï¼š`exonic`ï¼ŒåŸºå› å `CPN1`ã€‚

-   **å˜å¼‚ç±»å‹**ï¼šè¿™é‡Œéƒ½æ˜¯ `stopgain` â†’ äº§ç”Ÿæå‰ç»ˆæ­¢å¯†ç å­ã€‚

-   **è½¬å½•æœ¬æ³¨é‡Š**ï¼šä¾‹å¦‚ `NM_001308:exon9:c.A1363T:p.R455X` è¡¨ç¤ºåœ¨è½¬å½•æœ¬ NM_001308 çš„ç¬¬9å¤–æ˜¾å­ï¼Œæ ¸è‹·é…¸ A1363Tï¼Œå¯¼è‡´æ°¨åŸºé…¸ R455Xï¼ˆç²¾æ°¨é…¸å˜ä¸ºç»ˆæ­¢ï¼‰ã€‚

-   **åŠŸèƒ½é¢„æµ‹å­—æ®µ**ï¼šåé¢æœ‰ SIFTã€PolyPhen2ã€MutationAssessorã€MetaSVM ç­‰ç»“æœï¼ˆD=deleterious, N=neutral, A=ambiguousï¼‰ã€‚

-   **ClinVar/å…¶ä»–æ³¨é‡Š**ï¼šæœ‰æ—¶ä¼šå‡ºç° â€œRecessive; Highâ€ ç­‰æç¤ºï¼Œè¡¨ç¤ºé—ä¼ æ¨¡å¼å’ŒåŠŸèƒ½å½±å“ã€‚

## 2. ç¤ºä¾‹è§£è¯»

### å˜å¼‚ 1

ä»£ç 

```         
chr10 100042441 T>A exonic CPN1 stopgain NM_001308:exon9:c.A1363T:p.R455X 
```

-   **ç±»å‹**ï¼šstopgain â†’ è›‹ç™½æˆªçŸ­ã€‚

-   **å½±å“**ï¼šR455Xï¼Œä¸¢å¤± CPN1 è›‹ç™½ C ç«¯éƒ¨åˆ†ã€‚

-   **é¢„æµ‹**ï¼šéƒ¨åˆ†å·¥å…·æ˜¾ç¤º Dï¼ˆæœ‰å®³ï¼‰ï¼Œéƒ¨åˆ† Nï¼ˆä¸­æ€§ï¼‰ï¼Œä½†ä½œä¸º LOF å˜å¼‚ï¼Œæœ¬èº«å°±å±äºè‡´ç—…æ€§å€™é€‰ã€‚

### å˜å¼‚ 2

```         
chr10 100042441 T>A exonic CPN1 stopgain NM_001308:exon9:c.A1363T:p.R455X
```

-   **ç±»å‹**ï¼šstopgain â†’ è›‹ç™½æˆªçŸ­ã€‚

-   **å½±å“**ï¼šE447Xã€‚

-   **é¢„æµ‹**ï¼šPolyPhen2ã€MetaSVM æ˜¾ç¤º Dï¼ˆdeleteriousï¼‰ã€‚

-   **æ„ä¹‰**ï¼šåŒæ ·æ˜¯ LOF å˜å¼‚ã€‚

### å˜å¼‚ 3

```         
chr10 100042480 G>A exonic CPN1 stopgain NM_001308:exon9:c.C1324T:p.Q442X 
```

-   **ç±»å‹**ï¼šstopgainã€‚

-   **å½±å“**ï¼šQ442Xã€‚

-   **é¢„æµ‹**ï¼šå¤šå·¥å…·ä¸€è‡´ Dã€‚

-   **æ„ä¹‰**ï¼šå…¸å‹ LOFã€‚

### å…¶ä»–è¡Œï¼ˆY385X, Y351X, E349X, L331\*, W324X, Q321Xï¼‰

-   éƒ½æ˜¯ **stopgain** æˆ– **æˆªçŸ­å˜å¼‚**ï¼Œå±äº LOFã€‚

-   æ³¨é‡Šé‡Œå¸¸è§ â€œRecessive; Highâ€ â†’ æç¤ºå¯èƒ½çš„éšæ€§é—ä¼ æ¨¡å¼å’Œé«˜åŠŸèƒ½å½±å“ã€‚

-   éƒ¨åˆ†è¡Œæœ‰ç»“æ„åŸŸæ³¨é‡Šï¼ˆPeptidase M14, carboxypeptidase Aï¼‰ï¼Œè¯´æ˜å˜å¼‚è½åœ¨åŠŸèƒ½åŸŸå†…ï¼Œæ›´å¯èƒ½å½±å“è›‹ç™½åŠŸèƒ½ã€‚

## 3. è‡´ç—…æ€§å˜å¼‚å®šä¹‰åº”ç”¨

æ ¹æ®æˆ‘ä»¬çš„æ ‡å‡†ï¼š

-   **å¤±èƒ½å˜å¼‚ï¼ˆLOFï¼‰**ï¼šè¿™äº› stopgain å…¨éƒ¨ç¬¦åˆï¼Œç›´æ¥çº³å…¥ã€‚

-   **åŠŸèƒ½æ€§é”™ä¹‰å˜å¼‚**ï¼šéœ€è¦å¦å¤–ç­›é€‰ `exonic` + `nonsynonymous SNV`ï¼Œå¹¶æ£€æŸ¥ SIFTã€PolyPhen2ã€MutationAssessorã€MetaSVM å››ä¸ªå·¥å…·æ˜¯å¦ä¸€è‡´é¢„æµ‹ä¸ºæœ‰å®³ã€‚

-   **ClinVar è‡´ç—…æ€§**ï¼šå¦‚æœæ³¨é‡Šå­—æ®µé‡Œæœ‰ â€œPathogenicâ€ æˆ– â€œLikely Pathogenicâ€ï¼Œä¹Ÿè¦çº³å…¥ã€‚

ç›®å‰æˆ‘ä»¬å±•ç¤ºçš„ `CPN1_LOF.txt` å·²ç»æ˜¯ LOF é›†åˆï¼Œå±äºè‡´ç—…æ€§å˜å¼‚å…¨é›†çš„ä¸€éƒ¨åˆ†ã€‚

## 4. æ€»ç»“

-   æˆ‘ä»¬ç­›é€‰å‡ºçš„ CPN1 å˜å¼‚éƒ½æ˜¯ **æˆªçŸ­å‹ stopgain**ï¼Œå±äº **LOF è‡´ç—…æ€§å€™é€‰**ã€‚

-   è¿™äº›å˜å¼‚å¤§å¤šè½åœ¨è›‹ç™½åŠŸèƒ½åŸŸï¼ˆPeptidase M14ï¼‰ï¼Œæç¤ºå¯èƒ½ä¸¥é‡å½±å“ CPN1 åŠŸèƒ½ã€‚

## ç­›é€‰ ClinVar è‡´ç—…å˜å¼‚

``` bash
awk -F'\t' '$122 ~ /Pathogenic|Likely pathogenic/' gnomAD_CPN1_anno.hg38_multianno.txt > CPN1_ClinVar_pathogenic.txt
```

å¾—åˆ°çš„***CPN1_ClinVar_pathogenic.txt***ä¸ºç©ºawk -F'\t' '\$9 \~ /nonsynonymous SNV/ && \$20=="D" && \$21=="D" && \$22=="D" && \$23=="D"' gnomAD_CPN1_anno.hg38_multianno.txt \> CPN1_missense_functional.txt

è¯´æ˜åœ¨ç¬¬ 122 åˆ—ï¼ˆé€šå¸¸æ˜¯ ANNOVAR æ³¨é‡Šé‡Œ ClinVar çš„è‡´ç—…æ€§å­—æ®µï¼‰é‡Œç­›é€‰ **Pathogenic æˆ– Likely pathogenic**ã€‚è¾“å‡ºä¸ºç©ºï¼Œè¡¨ç¤ºåœ¨ gnomAD çš„æ³¨é‡Šæ–‡ä»¶é‡Œ **CPN1 åŸºå› æ²¡æœ‰ ClinVar æ ‡æ³¨ä¸ºè‡´ç—…æˆ–å¯èƒ½è‡´ç—…çš„å˜å¼‚**ã€‚

å› æ­¤ï¼Œ**CPN1 çš„è‡´ç—…æ€§å˜å¼‚å…¨é›†ç›®å‰åªåŒ…å« LOF å’ŒåŠŸèƒ½æ€§é”™ä¹‰é¢„æµ‹ä¸€è‡´çš„å˜å¼‚**ã€‚

è®¾å®šçš„å››ä¸ªå·¥å…·æ˜¯ï¼š

-   **SIFT_pred** â†’ ç¬¬ 13 åˆ—

-   **PolyPhen2_HVAR_pred** â†’ ç¬¬ 22 åˆ—

-   **MutationAssessor_pred** â†’ ç¬¬ 31 åˆ—

-   **MetaSVM_pred** â†’ ç¬¬ 42 åˆ—

``` bash
awk -F'\t' '$9 == "nonsynonymous SNV" && $13 == "D" && $22 == "D" && $31 == "D" && $42 == "D"' gnomAD_CPN1_anno.hg38_multianno.txt > CPN1_missense_functional.txt 
```

### ğŸ“Œ è¯´æ˜

ç­›é€‰å‡ºæ¥ä¸ºç©ºï¼Œå…¶å®è¯´æ˜äº†ä¸€ä¸ªäº‹å®ï¼šåœ¨ gnomAD çš„æ³¨é‡Šæ–‡ä»¶é‡Œï¼Œ**CPN1 åŸºå› ç›®å‰æ²¡æœ‰ç¬¦åˆæˆ‘ä»¬è®¾å®šæ¡ä»¶çš„é”™ä¹‰è‡´ç—…æ€§å€™é€‰**ã€‚

æ›´å®½æ¾ä¸€äº›ï¼Œå¯ä»¥è€ƒè™‘ï¼š

1.  **æ”¾å®½ä¸€è‡´æ€§è¦æ±‚**ï¼šæ¯”å¦‚è¦æ±‚è‡³å°‘ 3 ä¸ªå·¥å…·é¢„æµ‹ä¸ºæœ‰å®³ï¼Œè€Œä¸æ˜¯ 4 ä¸ªå…¨ä¸€è‡´ã€‚

    ``` bash
    awk -F'\t' '$9 == "nonsynonymous SNV" && (($13=="D")+($22=="D")+($31=="D")+($42=="D") >= 3)' gnomAD_CPN1_anno.hg38_multianno.txt > CPN1_missense_relaxed.txt 
    ```

    è¿™æ ·å¯ä»¥æ•æ‰æ›´å¤šæ½œåœ¨åŠŸèƒ½æ€§é”™ä¹‰å˜å¼‚ã€‚

``` bash
jayz@localhost:/mnt/e/acode/homwwork/data$ awk -F'\t' '$9 == "nonsynonymous SNV" && (($13=="D")+($22=="D")+($31=="D")+($42=="D") >= 3)' gnomAD_CPN1_anno.hg38_multianno.txt > CPN1_missense_relaxed.txt

jayz@localhost:/mnt/e/acode/homwwork/data$ head CPN1_missense_relaxed.txt
chr10   100042560       100042560       A       G       exonic  CPN1    .       nonsynonymous SNV CPN1:NM_001308:exon9:c.T1244C:p.L415P   0.0     0.913   D       0.019   0.592   D1.0      0.906   D       0.999   0.924   D       0.000   0.843   D       1       0.810   D4.54     0.991   H       -0.35   0.686   T       -3.48   0.679   D       0.9     0.900   0.476     0.902   D       0.620   0.866   D       0.988   0.992   D       0.827   0.987   D0.671    0.880   0.77    0.897   0.894   0.893   1.584   0.884   0.642   0.589   T       0.696     0.912   D       0.360   0.872   D       0.279   0.871   D       0.999   0.964   D0.663    0.272   T       .;      .;      4.107   0.823   27.8    0.999   0.935   0.929   0.569     D       0.804   0.729   D       0.707   0.801   0.539   0.706   1.000   0.518   0.615     0.376   0       .       .       4.97    4.97    0.654   4.525   0.603   1.312   0.947     1.000   0.716   0.540   0.279   11.330  0.487   Peptidase M14, carboxypeptidase A..       .       .       .       .       .
chr10   100048781       100048781       C       T       exonic  CPN1    .       nonsynonymous SNV CPN1:NM_001308:exon8:c.G1207A:p.V403M   0.01    0.785   D       0.005   0.722   D1.0      0.906   D       0.935   0.670   D       0.000   0.629   N       1       0.810   D4.08     0.972   H       0.52    0.553   T       -1.72   0.408   N       0.76    0.758   0.182     0.856   D       0.467   0.794   T       0.776   0.775   D       0.141   0.823   D0.348    0.673   0.623   0.758   0.576   0.572   1.151   0.792   0.486   0.369   T       0.491     0.816   T       0.067   0.605   T       0.028   0.721   D       0.992   0.819   D0.929    0.740   D       .;.;    .;.;    3.556   0.655   24.9    0.999   0.967   0.981   0.798     D       0.866   0.785   D       0.825   0.877   0.716   0.836   1.000   0.748   0.615     0.376   0       .       .       5.5     5.5     0.814   5.233   0.652   1.012   0.383     1.000   0.716   0.949   0.417   18.215  0.898   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A       .       .       .       .       .       .       . 
chr10   100048840       100048840       C       A       exonic  CPN1    .       nonsynonymous SNV CPN1:NM_001308:exon8:c.G1148T:p.G383V   0.0     0.913   D       0.0     0.928   D0.968    0.566   D       0.914   0.650   D       0.000   0.629   D       1       0.810   D4.565    0.992   H       1.58    0.612   T       -8.16   0.969   D       0.944   0.951   0.508     0.907   D       0.570   0.844   D       0.893   0.886   D       0.483   0.949   D0.495    0.783   0.653   0.791   0.904   0.903   0.621   0.564   0.609   0.542   T       0.735     0.926   D       0.342   0.860   D       0.254   0.858   D       0.999   0.974   D0.990    0.968   D       .;.;    .;.;    3.642   0.678   25.2    0.997   0.792   0.979   0.781     D       0.845   0.761   D       0.889   0.912   0.767   0.874   1.000   0.748   0.615     0.376   0       .       .       5.5     5.5     0.814   5.379   0.659   1.012   0.383     1.000   0.716   0.927   0.396   18.215  0.898   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A       .       .       .       .       .       .       . 
chr10   100048844       100048844       G       A       exonic  CPN1    .       nonsynonymous SNV CPN1:NM_001308:exon8:c.C1144T:p.P382S   0.002   0.722   D       0.006   0.706   D1.0      0.906   D       1.0     0.974   D       0.000   0.843   D       1       0.810   D3.59     0.936   H       2.14    0.510   T       -7.23   0.947   D       0.894   0.894   0.022     0.827   D       0.418   0.764   T       0.886   0.879   D       0.101   0.774   D0.736    0.909   0.696   0.833   0.828   0.827   1.216   0.810   0.631   0.573   T       0.700     0.914   D       0.300   0.830   D       0.193   0.827   D       0.999   0.944   D0.955    0.828   D       .;.;    .;.;    4.326   0.888   29.8    0.999   0.986   0.989   0.881     D       0.936   0.932   D       0.980   0.951   0.905   0.958   1.000   0.748   0.615     0.376   0       .       .       5.5     5.5     0.814   9.016   0.932   1.160   0.714     1.000   0.716   0.990   0.524   18.215  0.898   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A       .       .       .       .       .       .       . 
chr10   100048855       100048855       C       T       exonic  CPN1    .       nonsynonymous SNV CPN1:NM_001308:exon8:c.G1133A:p.R378Q   0.0     0.913   D       0.003   0.765   D1.0      0.906   D       0.998   0.886   D       0.000   0.843   D       1       0.810   D4.31     0.983   H       0.98    0.421   T       -3.67   0.710   D       0.94    0.947   0.157     0.852   D       0.424   0.768   T       0.772   0.772   D       0.169   0.847   D0.544    0.812   .       .       0.695   0.692   1.311   0.832   0.455   0.326   T       0.693     0.911   D       0.164   0.706   D       0.179   0.820   D       1.000   0.988   D0.996    0.986   D       .;.;    .;.;    4.201   0.855   28.7    1.000   1.000   0.984   0.820     D       0.886   0.818   D       1.027   0.965   0.934   0.969   1.000   0.748   0.615     0.376   0       .       .       5.5     5.5     0.814   7.113   0.767   1.012   0.383     1.000   0.716   1.000   0.863   18.215  0.898   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A       .       .       2351171 not_specified   MedGen:CN169374   criteria_provided,_single_submitter     Uncertain_significance
chr10   100048856       100048856       G       A       exonic  CPN1    .       nonsynonymous SNV CPN1:NM_001308:exon8:c.C1132T:p.R378W   0.0     0.913   D       0.0     0.928   D1.0      0.906   D       1.0     0.974   D       0.000   0.843   D       1       0.810   D4.31     0.983   H       0.98    0.421   T       -7.25   0.947   D       0.952   0.961   0.157     0.852   D       0.424   0.768   T       0.898   0.892   D       0.241   0.887   D0.683    0.885   0.745   0.876   0.776   0.774   1.254   0.819   0.613   0.548   T       0.735     0.926   D       0.206   0.744   D       0.154   0.805   D       1.000   0.993   D0.997    0.989   D       .;.;    .;.;    4.363   0.895   31      0.999   0.983   0.960   0.672     D       0.848   0.765   D       0.962   0.945   0.867   0.940   1.000   0.440   0.615     0.376   0       .       .       5.5     5.5     0.814   3.416   0.525   1.160   0.714     1.000   0.716   1.000   0.863   18.215  0.898   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A       .       .       .       .       .       .       . 
chr10   100048867       100048867       C       T       exonic  CPN1    .       nonsynonymous SNV CPN1:NM_001308:exon8:c.G1121A:p.G374D   0.001   0.913   D       0.0     0.928   D1.0      0.906   D       1.0     0.974   D       0.000   0.843   D       1       0.810   D4.61     0.993   H       -4.32   0.972   D       -6.43   0.913   D       0.989   0.997   1.073     0.987   D       0.973   0.992   D       0.988   0.992   D       0.815   0.986   D0.941    0.988   0.869   0.963   0.997   0.997   1.403   0.853   0.622   0.561   T       0.731     0.925   D       0.560   0.961   D       0.566   0.960   D       0.999   0.953   D0.946    0.973   D       .;.;    .;.;    3.677   0.687   25.3    0.998   0.915   0.983   0.819     D       0.888   0.820   D       0.900   0.917   0.738   0.853   1.000   0.748   0.615     0.376   0       .       .       5.5     5.5     0.814   7.113   0.767   1.012   0.383     1.000   0.716   0.296   0.240   18.215  0.898   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A       .       .       .       .       .       .       . 
chr10   100054362       100054362       G       C       exonic  CPN1    .       nonsynonymous SNV CPN1:NM_001308:exon7:c.C1096G:p.H366D   0.001   0.913   D       0.003   0.765   D1.0      0.906   D       1.0     0.974   D       0.000   0.629   D       1       0.810   D3.815    0.955   H       2.53    0.411   T       -8.61   0.977   D       0.843   0.839   0.085     0.839   D       0.384   0.740   T       0.825   0.816   D       0.100   0.773   D0.544    0.812   0.615   0.749   0.639   0.636   1.452   0.862   0.648   0.597   T       0.671     0.902   D       0.303   0.832   D       0.197   0.830   D       0.999   0.951   D0.986    0.951   D       .;.;    .;.;    4.265   0.874   29.3    0.994   0.615   0.980   0.790     D       0.930   0.916   D       0.883   0.909   0.759   0.868   1.000   0.748   0.578     0.328   0       .       .       4.23    4.23    0.493   8.026   0.892   1.176   0.789     1.000   0.716   1.000   0.863   16.387  0.833   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A       .       .       .       .       .       .       . 
chr10   100054371       100054371       C       T       exonic  CPN1    .       nonsynonymous SNV CPN1:NM_001308:exon7:c.G1087A:p.G363R   0.001   0.785   D       0.004   0.742   D1.0      0.906   D       0.98    0.748   D       0.000   0.629   D       1.000   0.588   D3.975    0.966   H       2.37    0.535   T       -6.62   0.921   D       0.729   0.730   0.260     0.869   D       0.443   0.781   T       0.921   0.914   D       0.181   0.855   D0.500    0.786   0.792   0.914   0.821   0.819   1.337   0.838   0.727   0.711   T       0.663     0.899   D       0.077   0.617   D       -0.030  0.684   D       0.998   0.935   D0.937    0.762   D       .;.;    .;.;    4.204   0.856   28.7    0.999   0.994   0.976   0.759     D       0.943   0.948   D       0.901   0.918   0.773   0.879   1.000   0.748   0.578     0.328   0       .       .       4.23    4.23    0.493   7.903   0.861   1.026   0.459     1.000   0.716   0.992   0.541   16.387  0.833   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A       .       .       .       .       .       .       . 
chr10   100054382       100054382       A       G       exonic  CPN1    .       nonsynonymous SNV CPN1:NM_001308:exon7:c.T1076C:p.I359T   0.0     0.913   D       0.001   0.834   D0.999    0.779   D       0.989   0.784   D       0.000   0.629   D       1       0.810   D4.32     0.983   H       0.58    0.541   T       -4.65   0.794   D       0.82    0.816   0.239     0.866   D       0.474   0.798   T       0.881   0.874   D       0.155   0.836   D0.706    0.896   0.768   0.895   0.696   0.694   1.381   0.848   0.754   0.751   T       0.671     0.902   D       0.337   0.856   D       0.246   0.854   D       0.998   0.940   D0.982    0.940   D       .;.;    .;.;    4.099   0.820   27.7    0.999   0.936   0.985   0.832     D       0.930   0.917   D       0.881   0.908   0.748   0.860   1.000   0.518   0.554     0.289   0       .       .       4.23    4.23    0.493   9.322   0.956   1.312   0.947     1.000   0.716   1.000   0.863   13.143  0.589   Peptidase M14, carboxypeptidase A;Peptidase M14, carboxypeptidase A     
```

## ç¤ºä¾‹å˜å¼‚è§£è¯»

### **L415P (chr10:100042560)**

-   **å˜å¼‚**ï¼šc.T1244C:p.L415P

-   **ä½ç½®**ï¼šç¬¬ 9 å¤–æ˜¾å­

-   **é¢„æµ‹**ï¼šSIFTã€PolyPhen2 HVARã€MutationAssessorã€MetaSVM å…¨éƒ¨ä¸º Dã€‚

-   **æ„ä¹‰**ï¼šæ°¨åŸºé…¸ç”±ç–æ°´æ€§äº®æ°¨é…¸å˜ä¸ºè„¯æ°¨é…¸ï¼Œå¯èƒ½ä¸¥é‡å½±å“è›‹ç™½æŠ˜å ã€‚

-   **ç»“è®º**ï¼šå¼ºçƒˆçš„åŠŸèƒ½æ€§å€™é€‰ã€‚

### **V403M (chr10:100048781)**

-   **å˜å¼‚**ï¼šc.G1207A:p.V403M

-   **é¢„æµ‹**ï¼šå¤§éƒ¨åˆ†å·¥å…·ä¸º Dï¼Œä½† MutationAssessor ç»™å‡º N/Tã€‚

-   **æ„ä¹‰**ï¼šé¢„æµ‹ç»“æœä¸å®Œå…¨ä¸€è‡´ï¼Œä½†ä»æ»¡è¶³ â‰¥3 å·¥å…·æœ‰å®³ã€‚

-   **ç»“è®º**ï¼šä¸­ç­‰å¯ä¿¡åº¦å€™é€‰ã€‚

### **G383V (chr10:100048840)**

-   **å˜å¼‚**ï¼šc.G1148T:p.G383V

-   **é¢„æµ‹**ï¼šå‡ ä¹æ‰€æœ‰å·¥å…·ä¸º Dã€‚

-   **æ„ä¹‰**ï¼šè½åœ¨ **Peptidase M14, carboxypeptidase A** åŠŸèƒ½åŸŸï¼Œæç¤ºå¯èƒ½å½±å“é…¶æ´»æ€§ã€‚

-   **ç»“è®º**ï¼šé«˜å¯ä¿¡åº¦å€™é€‰ã€‚

### **P382S (chr10:100048844)**

-   **å˜å¼‚**ï¼šc.C1144T:p.P382S

-   **é¢„æµ‹**ï¼šå¤§éƒ¨åˆ†å·¥å…·ä¸º Dã€‚

-   **æ„ä¹‰**ï¼šè„¯æ°¨é…¸ â†’ ä¸æ°¨é…¸ï¼Œå¯èƒ½æ”¹å˜ç»“æ„ç¨³å®šæ€§ã€‚

-   **ç»“è®º**ï¼šå€™é€‰ã€‚

### **R378Q / R378W (chr10:100048855â€“856)**

-   **å˜å¼‚**ï¼šc.G1133A:p.R378Q å’Œ c.C1132T:p.R378W

-   **é¢„æµ‹**ï¼šå¤§éƒ¨åˆ†å·¥å…·ä¸º Dã€‚

-   **ClinVar æ³¨é‡Š**ï¼šR378Q æœ‰ ClinVar æ¡ç›®ï¼ˆUncertain significanceï¼‰ã€‚

-   **æ„ä¹‰**ï¼šæç¤ºè¯¥ä½ç‚¹åœ¨ä¸´åºŠä¸Šå·²æœ‰å…³æ³¨ï¼Œä½†ç›®å‰è¯æ®ä¸è¶³ã€‚

-   **ç»“è®º**ï¼šå€™é€‰ï¼Œä½†éœ€ç»“åˆä¸´åºŠè¯æ®ã€‚

### **G374D (chr10:100048867)**

-   **å˜å¼‚**ï¼šc.G1121A:p.G374D

-   **é¢„æµ‹**ï¼šå‡ ä¹æ‰€æœ‰å·¥å…·ä¸º Dã€‚

-   **æ„ä¹‰**ï¼šè½åœ¨åŠŸèƒ½åŸŸå†…ï¼Œå¯èƒ½å½±å“é…¶æ´»æ€§ã€‚

-   **ç»“è®º**ï¼šé«˜å¯ä¿¡åº¦å€™é€‰ã€‚

### **H366D, G363R, I359T (chr10:100054362â€“382)**

-   **å˜å¼‚**ï¼šä½äºç¬¬ 7 å¤–æ˜¾å­ã€‚

-   **é¢„æµ‹**ï¼šå¤§éƒ¨åˆ†å·¥å…·ä¸º Dã€‚

-   **æ„ä¹‰**ï¼šå‡è½åœ¨åŠŸèƒ½åŸŸå†…ï¼Œæç¤ºå¯èƒ½å½±å“è›‹ç™½åŠŸèƒ½ã€‚

-   **ç»“è®º**ï¼šå€™é€‰ã€‚

## æ€»ä½“è§£è¯»

-   **å€™é€‰æ•°é‡**ï¼šå·²ç»æ•æ‰åˆ°å¤šä¸ªé”™ä¹‰å˜å¼‚ï¼Œä¸»è¦é›†ä¸­åœ¨ **ç¬¬ 7â€“9 å¤–æ˜¾å­**ï¼Œä¸”å¤§å¤šè½åœ¨ **Peptidase M14, carboxypeptidase A** åŠŸèƒ½åŸŸã€‚

-   **é¢„æµ‹ä¸€è‡´æ€§**ï¼šå¤šæ•°å˜å¼‚åœ¨ â‰¥3 å·¥å…·ä¸­é¢„æµ‹ä¸ºæœ‰å®³ï¼Œéƒ¨åˆ†ç”šè‡³ 4/4 ä¸€è‡´ã€‚

-   **ä¸´åºŠæ³¨é‡Š**ï¼šR378Q æœ‰ ClinVar æ¡ç›®ï¼Œä½†ç›®å‰ä¸º â€œUncertain significanceâ€ã€‚

-   **åŠŸèƒ½æ„ä¹‰**ï¼šè¿™äº›å˜å¼‚å¯èƒ½å½±å“ CPN1 çš„é…¶æ´»æ€§æˆ–ç»“æ„ç¨³å®šæ€§ï¼Œæ˜¯æ½œåœ¨çš„è‡´ç—…æ€§å€™é€‰ã€‚

------------------------------------------------------------------------

``` r

# 1. è®¾ç½® tokenï¼ˆåªéœ€ä¸€æ¬¡ï¼‰
Sys.setenv(OPENGWAS_JWT = "eyJhbGciOiJSUzI1NiIsImtpZCI6ImFwaS1qd3QiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJhcGkub3Blbmd3YXMuaW8iLCJhdWQiOiJhcGkub3Blbmd3YXMuaW8iLCJzdWIiOiIzMTQzNTM0ODkxQHFxLmNvbSIsImlhdCI6MTc2Mzk3NTg0NywiZXhwIjoxNzY1MTg1NDQ3fQ.ZFHeL8QswhmATx4S2DTLNNXmt-b7kBdlJQWB6rY-i6E7pO0J4QkgQp1zyvyq2ktXwcijfj1VdfM4pitUY0-jlcBMpHa8hH_9_BTgaCmGqHiw2SBsJr7n69jdywpTPKNJTKDndoiWDzNLDdXKNMbgqTKO2OltnEoMTTb5pPacM2KruzIj3i6XLEKf3AyEEt4WGcZ--1g5bq1icE75eVCFzR7W234bK4aZrWs8Hw5RQSo9ixo8vYh034dQ55byaanH3ahDGgvjySv0b_V-uuw1_I7AuMz2OpGdFRqbxf3BG8Gl0GiwPJHX9evZpPqpdGZZjmY_HZO_xMc-2CPNCHghhg")

library(TwoSampleMR)
library(ieugwasr)



# 2. é€‰æ‹©æš´éœ²å’Œç»“å±€ GWAS ID
ex_id <- "ukb-b-3016"   # æš´éœ²ï¼šYears since last breast cancer screening / mammogram
out_id <- "ieu-b-102"   # ç»“å±€ï¼šMajor depression (2019, Nâ‰ˆ500k)

# 3. æå–æš´éœ²å·¥å…·å˜é‡ (æ”¾å®½é˜ˆå€¼ä»¥è·å–æ›´å¤š SNP)
exposure_dat <- extract_instruments(outcomes = ex_id, p1 = 1e-5, clump = TRUE)

# 4. æå–ç»“å±€æ•°æ®
outcome_dat <- extract_outcome_data(snps = exposure_dat$SNP, outcomes = out_id)

# 5. åè°ƒæ•°æ®
dat <- harmonise_data(exposure_dat, outcome_dat)

# 6. ä¸» MR åˆ†æ
mr_res <- mr(dat)
print(mr_res)

# 7. æ•æ„Ÿæ€§åˆ†æ
het     <- mr_heterogeneity(dat)      # å¼‚è´¨æ€§
pleio   <- mr_pleiotropy_test(dat)    # æ°´å¹³å¤šæ•ˆæ€§ (Egger æˆªè·)
single  <- mr_singlesnp(dat)          # å• SNP åˆ†æ
loo     <- mr_leaveoneout(dat)        # ç•™ä¸€æ³•åˆ†æ

# 8. Steiger æ£€éªŒ (æ–¹å‘æ€§)
dat_steiger <- steiger_filtering(dat)
mr_res_steiger <- mr(dat_steiger)

# 9. å¯è§†åŒ–
mr_scatter_plot(mr_res, dat)
mr_leaveoneout_plot(loo)
```

------------------------------------------------------------------------

## 4.å…¨åŸºå› ç»„å…³è”æ€§åˆ†æGWAS

åœ¨[[https://www.kdocs.cn/l/caALpwLoJmmi]{.underline}](https://www.kdocs.cn/l/caALpwLoJmmi)è®¤é¢†å¤§è„‘ä½“ç§¯GWASï¼Œé™„ä»¶ä¸­é€‰æ‹©ç›¸åº”æ•°æ®ç»˜åˆ¶æ›¼å“ˆé¡¿å›¾ã€‚è§£é‡Šè¯¥å›¾ä»¥åŠç»“æœã€‚

## 1. è®¾ç½®ç¯å¢ƒä¸è¿æ¥ OpenGWAS

è®¾ç½®äº† tokenï¼Œè¿™æ˜¯è®¿é—® IEU OpenGWAS çš„å¿…è¦æ­¥éª¤ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ `TwoSampleMR` åŒ…æ¥è·å–æ•°æ®ã€‚

è¿™ä¸ªæ˜¯æˆ‘ä»¬çš„ç›®æ ‡gwasæ•°æ®

![](images/å±å¹•æˆªå›¾%202025-12-03%20161813.png)

```r
# å®‰è£…å¹¶åŠ è½½å¿…è¦åŒ…
library(TwoSampleMR)
library(ieugwasr)
library(ggplot2)

Sys.setenv(OPENGWAS_JWT = "eyJhbGciOiJSUzI1NiIsImtpZCI6ImFwaS1qd3QiLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJhcGkub3Blbmd3YXMuaW8iLCJhdWQiOiJhcGkub3Blbmd3YXMuaW8iLCJzdWIiOiIzMTQzNTM0ODkxQHFxLmNvbSIsImlhdCI6MTc2Mzk3NTg0NywiZXhwIjoxNzY1MTg1NDQ3fQ.ZFHeL8QswhmATx4S2DTLNNXmt-b7kBdlJQWB6rY-i6E7pO0J4QkgQp1zyvyq2ktXwcijfj1VdfM4pitUY0-jlcBMpHa8hH_9_BTgaCmGqHiw2SBsJr7n69jdywpTPKNJTKDndoiWDzNLDdXKNMbgqTKO2OltnEoMTTb5pPacM2KruzIj3i6XLEKf3AyEEt4WGcZ--1g5bq1icE75eVCFzR7W234bK4aZrWs8Hw5RQSo9ixo8vYh034dQ55byaanH3ahDGgvjySv0b_V-uuw1_I7AuMz2OpGdFRqbxf3BG8Gl0GiwPJHX9evZpPqpdGZZjmY_HZO_xMc-2CPNCHghhg")

# æŸ¥è¯¢ GWAS ä¿¡æ¯
gwas_info <- gwasinfo("ubm-b-343")
print(gwas_info)
```

``` bash
Rows: 1
Columns: 16
$ id          <chr> "ubm-b-343"
$ trait       <chr> "Brainstem_global_volume_Whole-brainstem"
$ build       <chr> "HG19/GRCh37"
$ group_name  <chr> "public"
$ category    <lgl> NA
$ subcategory <lgl> NA
$ population  <chr> "European"
$ sex         <chr> "Males and Females"
$ author      <chr> "Elliott LT"
$ nsnp        <int> 17103079
$ sample_size <int> 31968
$ year        <int> 2021
$ consortium  <lgl> NA
$ pmid        <int> 33875891
$ mr          <int> 1
$ note        <chr> "UKB 26720 Volume of Whole-brainstem in the whole brain geâ€¦
```

## 2. ä¸‹è½½ GWAS summary æ•°æ®

```r

# ä¸‹è½½ GWAS summary æ•°æ®ï¼ˆæŒ‰ p å€¼é˜ˆå€¼ç­›é€‰ï¼‰
gwas_dat <- associations(id = "ubm-b-343", pval = 1e-5)

head(gwas_dat)

```

é€šå¸¸åŒ…å«å­—æ®µï¼š`rsid`, `chr`, `pos`, `pval`, `beta`, `se` ç­‰ã€‚

### ***ä¸‹è½½ä¸ä¸‹æ¥ï¼Œéšä¾¿ç”¨ä¸€ä¸ªè€å¸ˆçš„***

## 3. ç»˜åˆ¶æ›¼å“ˆé¡¿å›¾

æ›¼å“ˆé¡¿å›¾å±•ç¤ºæ¯ä¸ª SNP çš„ -log10(p å€¼)ï¼ŒæŒ‰æŸ“è‰²ä½“ä½ç½®æ’åˆ—ã€‚

```r
# è½½å…¥æ•°æ®

gwas_data <- read.csv("E:/acode/homwwork/data3/GCST90085833_buildGRCh38.csv", 
                      header = TRUE, 
                      stringsAsFactors = FALSE)

# æŸ¥çœ‹æ•°æ®çš„å‰å‡ è¡Œå’Œåˆ—å
# è¿™æ ·å¯ä»¥çœ‹åˆ°æ•°æ®ç»“æ„å’Œåˆ—åï¼Œè¿™æ˜¯ç»˜åˆ¶æ›¼å“ˆé¡¿å›¾çš„å…³é”®ï¼
print("--- æ•°æ®é›†çš„å‰å…­è¡Œ ---")
head(gwas_data)

print("--- æ•°æ®é›†çš„åˆ—å ---")
colnames(gwas_data)

```

``` r
[1] "--- æ•°æ®é›†çš„å‰å…­è¡Œ ---"
         SNP         pval chr      pos effect_allele
1  rs6671868 5.394361e-06   1  9729599             G
2 rs79583983 1.689546e-06   1  9743826             A
3 rs74338407 9.904214e-06   1  9747743             C
4  rs3795686 2.024417e-06   1 26582091             G
5 rs12750420 1.332202e-06   1 26608649             G
6 rs34209692 1.257622e-06   1 26608782             C
  other_allele      eaf      beta      se samplesize
1            A 0.919834  -90.1097 19.8094      36778
2            T 0.955883 -125.9860 26.3162      36778
3            T 0.959993 -121.8760 27.5784      36778
4            A 0.686416   54.9259 11.5610      36778
5            A 0.686392   55.9015 11.5621      36778
6            T 0.686446   56.0350 11.5623      36778
                 Phenotype
1 GCST90085833_buildGRCh38
2 GCST90085833_buildGRCh38
3 GCST90085833_buildGRCh38
4 GCST90085833_buildGRCh38
5 GCST90085833_buildGRCh38
6 GCST90085833_buildGRCh38
[1] "--- æ•°æ®é›†çš„åˆ—å ---"
 [1] "SNP"           "pval"          "chr"          
 [4] "pos"           "effect_allele" "other_allele" 
 [7] "eaf"           "beta"          "se"           
[10] "samplesize"    "Phenotype"
```

```r
library(qqman)


man_dat <- data.frame(
  SNP = gwas_dat$rsid,
  CHR = as.numeric(gwas_dat$chr),
  BP  = as.numeric(gwas_dat$pos),
  P   = gwas_dat$p
)

manhattan(man_dat,
          genomewideline = -log10(5e-8),
          suggestiveline = -log10(1e-5),
          main = "Manhattan plot for Brain Volume GWAS (ubm-b-343)")

```

### ğŸ‰ æ›¼å“ˆé¡¿å›¾ç»˜å›¾å‡†å¤‡

ä»åˆ—åå¯ä»¥çœ‹å‡ºï¼Œç»˜åˆ¶æ›¼å“ˆé¡¿å›¾æ‰€éœ€çš„ä¸‰ä¸ªæ ¸å¿ƒä¿¡æ¯å·²ç»é½æ´»ï¼Œè€Œä¸”åˆ—åéå¸¸æ¸…æ™°ï¼š

-   **å…³è”å¼ºåº¦ï¼š** `"pval"` (P-value)

-   **æŸ“è‰²ä½“ï¼š** `"chr"` (Chromosome)

-   **ç‰©ç†ä½ç½®ï¼š** `"pos"` (Position)

### ğŸ¨ ç»˜åˆ¶æ›¼å“ˆé¡¿å›¾ï¼ˆManhattan Plotï¼‰

#### 1. å®‰è£…å’ŒåŠ è½½ `qqman` åŒ…

```r
 library(qqman) 
```

#### 2. ç»˜åˆ¶æ›¼å“ˆé¡¿å›¾

åœ¨ç»˜åˆ¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¤„ç†ä¸€ä¸‹æ•°æ®ç±»å‹ï¼Œç¡®ä¿ `chr` å’Œ `pos` æ˜¯æ•°å€¼å‹ï¼Œ`pval` æ˜¯æ•°å€¼å‹ï¼ˆè™½ç„¶å®ƒçœ‹èµ·æ¥å·²ç»æ˜¯ï¼‰ã€‚

```r
# ç¡®ä¿æ•°æ®ç±»å‹æ­£ç¡®
# æ³¨æ„ï¼šæˆ‘ä»¬å‡è®¾ chr åˆ—å·²ç»æ˜¯æ•°å­— 1-22 æˆ– X/Y/MTã€‚
# å¦‚æœ chr åŒ…å« X, Yï¼Œqqman ä¼šè‡ªåŠ¨å¤„ç†ã€‚
gwas_data$chr <- as.numeric(gwas_data$chr)
gwas_data$pos <- as.numeric(gwas_data$pos)
gwas_data$pval <- as.numeric(gwas_data$pval)

# ä½¿ç”¨ manhattan å‡½æ•°ç»˜å›¾
manhattan(
    x = gwas_data,
    # å‘Šè¯‰å‡½æ•°På€¼ã€æŸ“è‰²ä½“ã€ä½ç½®å’ŒSNPåç§°åˆ†åˆ«å¯¹åº”å“ªä¸ªåˆ—
    chr = "chr",
    bp = "pos",
    p = "pval",
    snp = "SNP",
    
    # å›¾å½¢æ ‡é¢˜å’ŒYè½´æ ‡ç­¾
    main = "Manhattan Plot for GCST90085833", # ä¸»æ ‡é¢˜
    ylab = expression(-log[10](italic(P))), # Yè½´æ ‡ç­¾ï¼š-log10(P)
    
    # è®¾ç½®æ˜¾è‘—æ€§é˜ˆå€¼ï¼ˆé€šå¸¸ä¸º 5e-8ï¼Œå³ 5 x 10^-8ï¼‰
    # genome-wide significance line (çº¢çº¿)
    suggestiveline = FALSE, # ä¸ç»˜åˆ¶æç¤ºçº¿
    genomewideline = 5e-8,  # ç»˜åˆ¶å…¨åŸºå› ç»„æ˜¾è‘—æ€§çº¢çº¿
    
    # è®¾ç½®é¢œè‰²ï¼ˆè®©å›¾çœ‹èµ·æ¥æ›´ç¾è§‚ï¼‰
    col = c("blue4", "orange3") 
)
```

### ğŸ“ˆ æ›¼å“ˆé¡¿å›¾ç»“æœè§£é‡Š

#### 1. æ›¼å“ˆé¡¿å›¾æ˜¯ä»€ä¹ˆï¼Ÿ

æ›¼å“ˆé¡¿å›¾æ˜¯ **GWAS ç»“æœå¯è§†åŒ–**çš„æ ‡å‡†æ–¹å¼ã€‚å®ƒå¾—åäºçº½çº¦æ›¼å“ˆé¡¿çš„å¤©é™…çº¿ï¼Œå›¾ä¸Šé«˜è€¸çš„â€œæ‘©å¤©å¤§æ¥¼â€ä»£è¡¨ç€ä¸è¡¨å‹**é«˜åº¦æ˜¾è‘—å…³è”**çš„åŸºå› ç»„åŒºåŸŸã€‚

-   **X è½´ï¼š** è¡¨ç¤ºåŸºå› ç»„ä¸Šçš„ä½ç½®ï¼Œä»å·¦åˆ°å³ä¾æ¬¡æ’åˆ—äº†æ‰€æœ‰æŸ“è‰²ä½“ (Chromosome)ï¼Œé€šå¸¸ç”¨äº¤æ›¿çš„é¢œè‰²æ¥åŒºåˆ†ä¸åŒçš„æŸ“è‰²ä½“ã€‚

-   **Y è½´ï¼š** è¡¨ç¤ºå…³è”çš„å¼ºåº¦ï¼Œæ˜¯ä»¥ $-\log_{10}(P)$ å€¼è¡¨ç¤ºçš„ã€‚

    -   **P å€¼è¶Šå°**ï¼ˆå…³è”è¶Šæ˜¾è‘—ï¼‰ï¼Œåˆ™ $-\log_{10}(P)$ **è¶Šå¤§**ï¼Œç‚¹å°±è¶Šé«˜ã€‚

-   **çº¢çº¿ï¼ˆå…¨åŸºå› ç»„æ˜¾è‘—æ€§é˜ˆå€¼ï¼‰ï¼š** è¿™æ¡çº¿é€šå¸¸ä½äº $P = 5 \times 10^{-8}$ï¼ˆå³ $-\log_{10}(5 \times 10^{-8}) \approx 7.3$ï¼‰çš„ä½ç½®ã€‚

#### 2. å¦‚ä½•è§£é‡Šç»“æœï¼Ÿ

-   **å¦‚æœå›¾ä¸­æœ‰â€œæ‘©å¤©å¤§æ¥¼â€ (å³ç‚¹çªç ´çº¢çº¿)ï¼š**

    -   è¿™è¡¨ç¤ºåœ¨è¿™äº›æŸ“è‰²ä½“åŒºåŸŸå­˜åœ¨**ä¸ç ”ç©¶è¡¨å‹ï¼ˆGCST90085833ï¼‰æœ‰é«˜åº¦ç»Ÿè®¡å­¦æ„ä¹‰å…³è”**çš„ SNP ä½ç‚¹ã€‚

    -   è¿™äº›ä½ç‚¹å¯èƒ½æ˜¯**å› æœå˜å¼‚**ï¼Œæˆ–ä¸å› æœå˜å¼‚**é«˜åº¦è¿é”ä¸å¹³è¡¡**ï¼ˆLDï¼‰ã€‚

    -   æœ€é«˜çš„â€œæ‘©å¤©å¤§æ¥¼â€æ‰€åœ¨çš„åŒºåŸŸï¼ˆé€šå¸¸ç§°ä¸º **GWAS hits**ï¼‰æ˜¯éœ€è¦é‡ç‚¹å…³æ³¨å’Œè¿›ä¸€æ­¥ç ”ç©¶çš„**å…³é”®åŸºå› ç»„ä½ç‚¹**ã€‚

-   **å¦‚æœæ‰€æœ‰ç‚¹éƒ½åœ¨çº¢çº¿ä¸‹æ–¹ï¼š**

    -   è¿™è¡¨ç¤ºåœ¨è¯¥ç ”ç©¶ä¸­ï¼Œæ²¡æœ‰ SNP è¾¾åˆ°**å…¨åŸºå› ç»„æ˜¾è‘—æ€§æ°´å¹³**ï¼Œå³æ²¡æœ‰æ‰¾åˆ°å¯ä»¥ç¡®å‡¿å®£å¸ƒçš„å…³è”ä½ç‚¹ã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºæ ·æœ¬é‡ä¸è¶³ã€æ•ˆåº”å€¼å¤ªå°ã€æˆ–è¯¥è¡¨å‹å—é—ä¼ å› ç´ å½±å“è¾ƒå°ç­‰åŸå› ã€‚

-   **å›¾ä¸­çš„â€œåœ°æ¯¯â€ï¼š**

    -   X è½´ä¸Šé è¿‘åœ°é¢çš„ç‚¹æ˜¯é‚£äº› P å€¼è¾ƒå¤§çš„ SNPï¼Œå®ƒä»¬çš„å…³è”æ€§ä¸æ˜¾è‘—ã€‚

![](plot-125.png)

-   **å…³è”å¼ºåº¦åˆ†å¸ƒï¼š** å¤§å¤šæ•° SNP ä½äºè¾ƒä½çš„ P å€¼åŒºåŸŸï¼ˆå›¾ä¸­ Y è½´åº•éƒ¨ï¼‰ï¼Œç¬¦åˆé¢„æœŸã€‚åªæœ‰å°‘æ•°å…³é”®åŒºåŸŸå±•ç°å‡ºæé«˜çš„æ˜¾è‘—æ€§ã€‚

-   **é¢œè‰²äº¤æ›¿ï¼š** è“ç‚¹å’Œæ©™ç‚¹äº¤æ›¿å‡ºç°ï¼Œæ¸…æ™°åœ°åŒºåˆ†äº†ä¸åŒçš„æŸ“è‰²ä½“ï¼Œæ–¹ä¾¿æˆ‘ä»¬å®šä½å…³è”ä¿¡å·ã€‚

-   **ç°‡ç¾¤ç°è±¡ï¼š** ä¿¡å·å¾€å¾€ä»¥**ç°‡ç¾¤**çš„å½¢å¼å‡ºç°ï¼ˆæ¯”å¦‚ 3 å·å’Œ 6 å·æŸ“è‰²ä½“ï¼‰ï¼Œè€Œä¸æ˜¯å•ä¸ªå­¤ç«‹çš„ç‚¹ï¼Œè¿™ç¬¦åˆ GWAS çš„é¢„æœŸã€‚å› ä¸ºä¸€ä¸ªå¼ºå…³è”çš„ SNP å‘¨å›´ï¼Œä¸å…¶ LD çš„å…¶ä»– SNP ä¹Ÿä¼šåŒæ—¶æ˜¾ç¤ºå‡ºå¼ºå…³è”ä¿¡å·ã€‚

------------------------------------------------------------------------

## å‡†å¤‡æ•°æ®

```r
library(TwoSampleMR)
library(dplyr)
library(ggplot2)


# 1) æŒ‡å®šæš´éœ²ä¸ç»“å±€
ex_id  <- "ubm-b-343"   # Brain volume
out_id <- "ieu-b-102"   # Major depression (2019, N~500k)

# 2) æå–æš´éœ²å·¥å…·å˜é‡ï¼ˆæ”¾å®½é˜ˆå€¼ + clump å»é™¤è¿é”ï¼‰
# p1: æš´éœ²é€‰æ‹©é˜ˆå€¼ï¼›é»˜è®¤ clump=TRUE ä½¿ç”¨ 10000kb, r2=0.001
exposure_dat <- extract_instruments(
  outcomes = ex_id,
  p1 = 1e-5,
  clump = TRUE
)

# å¦‚å·¥å…·æ•°ç›®è¿‡å¤š/è¿‡å°‘ï¼Œå¯è§†åŒ– F å€¼æˆ– p åˆ†å¸ƒåšæ£€æŸ¥
# table(exposure_dat$exposure), summary(exposure_dat$pval.exposure)

# 3) æå–ç»“å±€æ•ˆåº”
outcome_dat <- extract_outcome_data(
  snps = exposure_dat$SNP,
  outcomes = out_id
)

# 4) åè°ƒæ•°æ®ï¼ˆç­‰ä½åŸºå› æ–¹å‘ä¸€è‡´ï¼Œå‰”é™¤ä¸ä¸€è‡´æˆ–å›æ–‡ä½ç‚¹ï¼‰
dat <- harmonise_data(exposure_dat, outcome_dat)
```

## MR

```r
# 5) ä¸» MR åˆ†æï¼šIVWã€MR-Eggerã€Weighted medianã€Weighted mode
mr_res <- mr(dat)
print(mr_res)

# 6) ç»“æœçš„ç®€è¡¨ï¼ˆbetaã€seã€pã€æ–¹æ³•ï¼‰
mr_res %>%
  select(method, b, se, pval, nsnp) %>%
  arrange(pval) %>% print(n=100)
```

è§£é‡Šå»ºè®®ï¼š

-   **IVW** æ˜¯ä¸»åˆ†æï¼ˆåœ¨å·¥å…·æœ‰æ•ˆä¸”æ— æ–¹å‘æ€§å¤šæ•ˆæ€§æ—¶æœ€æœ‰åŠ›ï¼‰ã€‚

-   **MR-Egger** å¯æ£€æµ‹æ–¹å‘æ€§æ°´å¹³å¤šæ•ˆæ€§ï¼ˆæ‹¦æˆªé¡¹ï¼‰ï¼Œä½†æ•ˆç‡è¾ƒä½ã€‚

-   **Weighted median** å¯¹ä¸€åŠå·¥å…·æ— æ•ˆä»ç¨³å¥ã€‚

-   **Weighted mode** åœ¨ç›¸åŒæ•ˆåº”çš„â€œå¯†é›†ç°‡â€å­˜åœ¨æ—¶ç¨³å¥ã€‚

``` r
Analysing 'ubm-b-343' on 'ieu-b-102'
  id.exposure id.outcome                          outcome
1   ubm-b-343  ieu-b-102 Major depression || id:ieu-b-102
2   ubm-b-343  ieu-b-102 Major depression || id:ieu-b-102
3   ubm-b-343  ieu-b-102 Major depression || id:ieu-b-102
4   ubm-b-343  ieu-b-102 Major depression || id:ieu-b-102
5   ubm-b-343  ieu-b-102 Major depression || id:ieu-b-102
                                                 exposure
1 Brainstem_global_volume_Whole-brainstem || id:ubm-b-343
2 Brainstem_global_volume_Whole-brainstem || id:ubm-b-343
3 Brainstem_global_volume_Whole-brainstem || id:ubm-b-343
4 Brainstem_global_volume_Whole-brainstem || id:ubm-b-343
5 Brainstem_global_volume_Whole-brainstem || id:ubm-b-343
                     method nsnp            b         se
1                  MR Egger  123 -0.035530504 0.04885154
2           Weighted median  123 -0.040355943 0.01522739
3 Inverse variance weighted  123 -0.031026974 0.01495876
4               Simple mode  123 -0.005203456 0.04478171
5             Weighted mode  123 -0.053875456 0.03564262
         pval
1 0.468437389
2 0.008043911
3 0.038063779
4 0.907688261
5 0.133235351
```

## Sensitivity analyses and diagnostics

```r
# 7) å¼‚è´¨æ€§ï¼ˆCochranâ€™s Qï¼‰
het <- mr_heterogeneity(dat)
print(het)

# 8) æ°´å¹³å¤šæ•ˆæ€§ï¼ˆEgger æˆªè·ï¼‰
pleio <- mr_pleiotropy_test(dat)
print(pleio)

# 9) å• SNP ä¸ç•™ä¸€æ³•
single <- mr_singlesnp(dat)
loo    <- mr_leaveoneout(dat)

# 10) Steiger æ–¹å‘æ€§æ£€éªŒï¼ˆæš´éœ²â†’ç»“å±€ï¼‰
# Steiger æ£€éªŒéœ€è¦çŸ¥é“æ¯ä¸ª GWAS çš„ æ ·æœ¬é‡ (sample size) å’Œ æ•ˆåº”å€¼ (beta, se, maf) æ¥è®¡ç®—æ–¹å·®è§£é‡Šåº¦
dat_steiger <- steiger_filtering(dat)
mr_res_steiger <- mr(dat_steiger)
print(mr_res_steiger)
```

è§£è¯»è¦ç‚¹ï¼š

-   **å¼‚è´¨æ€§æ˜¾è‘—**ï¼ˆQ p\<0.05ï¼‰æç¤ºå·¥å…·ä¹‹é—´æ•ˆåº”å·®å¼‚è¾ƒå¤§ï¼Œå¯èƒ½å­˜åœ¨å¤šæ•ˆæ€§æˆ–æµ‹é‡è¯¯å·®ã€‚

-   **Egger æˆªè·æ˜¾è‘—**ï¼ˆp\<0.05ï¼‰æç¤ºæ–¹å‘æ€§æ°´å¹³å¤šæ•ˆæ€§ï¼ŒIVW å¯èƒ½åå€šã€‚æ­¤æ—¶æ›´ä¿¡ä»» Weighted median/Mode æˆ–è¿›è¡Œ MR-PRESSOï¼ˆè‹¥éœ€ï¼‰ã€‚

-   **Steiger æ£€éªŒ**è‹¥æ˜¾ç¤ºå¤šæ•° SNP çš„æš´éœ²æ–¹å·®è§£é‡Šåº¦å¤§äºç»“å±€ï¼Œæ”¯æŒå› æœæ–¹å‘ä¸º â€œè„‘ä½“ç§¯ â†’ æŠ‘éƒâ€ï¼›åä¹‹éœ€è°¨æ…ã€‚

``` r
print(mr_res_steiger)
  id.exposure id.outcome                          outcome
1   ubm-b-343  ieu-b-102 Major depression || id:ieu-b-102
2   ubm-b-343  ieu-b-102 Major depression || id:ieu-b-102
                                                 exposure
1 Brainstem_global_volume_Whole-brainstem || id:ubm-b-343
2 Brainstem_global_volume_Whole-brainstem || id:ubm-b-343
                     method        Q Q_df       Q_pval
1                  MR Egger 342.6088  121 4.632164e-23
2 Inverse variance weighted 342.6353  122 7.777362e-23
  id.exposure id.outcome                          outcome
1   ubm-b-343  ieu-b-102 Major depression || id:ieu-b-102
                                                 exposure
1 Brainstem_global_volume_Whole-brainstem || id:ubm-b-343
  egger_intercept          se      pval
1    0.0002488173 0.002568281 0.9229813
Try adding metadata with add_metadata()
Try adding metadata with add_metadata()
```

## å¯è§†åŒ–

```r
# 11) æ•£ç‚¹å›¾ï¼ˆå„æ–¹æ³•çš„å›å½’çº¿ï¼‰
plots_scatter <- mr_scatter_plot(mr_res, dat)
print(plots_scatter[[1]])

# 12) ç•™ä¸€æ³•æ£®æ—å›¾
plots_loo <- mr_leaveoneout_plot(loo)
print(plots_loo[[1]])

# 13) å• SNP æ£®æ—å›¾
TwoSampleMR::mr_forest_plot(single)

# 14) Funnel å›¾ï¼ˆè¯„ä¼°å°æ ·æœ¬åå€š/å¯¹ç§°æ€§ï¼‰
TwoSampleMR::mr_funnel_plot(single)
```

è¿™äº›å›¾å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½é©±åŠ¨ç»“æœçš„ SNPã€è¯„ä¼°å¤šæ•ˆæ€§ä¸å¯¹ç§°æ€§ï¼Œå¹¶å¯ç”„åˆ«å¼‚å¸¸çš„å•ç‚¹å·¥å…·ã€‚

## ç»“æœä»‹ç»

å½“æˆ‘ä»¬è·‘å®Œä¸Šè¿°ä»£ç åï¼Œè¯·æŒ‰ä»¥ä¸‹é€»è¾‘è§£è¯»ï¼š

-   **æ–¹å‘ä¸å¤§å°ï¼š**

    -   IVW ç»™å‡ºå› æœæ•ˆåº”ä¼°è®¡ï¼šbï¼ˆæ¯å•ä½è„‘ä½“ç§¯å˜åŒ–å¯¼è‡´æŠ‘éƒé£é™©çš„å˜åŒ–ï¼Œé€šå¸¸ log-oddsï¼‰ã€‚è‹¥ b\<0 ä¸”æ˜¾è‘—ï¼Œè¡¨ç¤ºæ›´å¤§çš„è„‘ä½“ç§¯ä¸æ›´ä½çš„æŠ‘éƒé£é™©ç›¸å…³ï¼›b\>0 ç›¸åã€‚

-   **æ˜¾è‘—æ€§ä¸ç¨³å¥æ€§ï¼š**

    -   è‹¥ IVW æ˜¾è‘—ï¼ˆp\<0.05ï¼‰ï¼Œä¸”å¼‚è´¨æ€§ä¸é«˜ã€Egger æˆªè·ä¸æ˜¾è‘—ï¼Œåˆ™ç»“æœè¾ƒä¸ºç¨³å¥ã€‚

    -   è‹¥ IVW æ˜¾è‘—ä½†å­˜åœ¨å¤šæ•ˆæ€§æˆ–é«˜å¼‚è´¨æ€§ï¼Œå‚è€ƒ Weighted median/Mode çš„ä¸€è‡´æ€§ï¼›å¦‚ä¸€è‡´ï¼Œä»æ”¯æŒå› æœï¼›å¦‚ä¸ä¸€è‡´ï¼Œéœ€è°¨æ…ã€‚

-   **æ–¹å‘æ€§ï¼ˆSteigerï¼‰ï¼š**

    -   è‹¥ Steiger è¿‡æ»¤åç»“æœä¸åŸç»“è®ºä¸€è‡´ï¼Œæ–¹å‘æ€§æ›´å¯é ã€‚

-   **æ•æ„Ÿæ€§ï¼š**

    -   ç•™ä¸€æ³•è‹¥ç§»é™¤ä»»ä¸€ SNP åæ•ˆåº”ç¨³å®šï¼Œè¯´æ˜ä¸»ç»“è®ºä¸ä¾èµ–å•ä¸ªå·¥å…·ã€‚

    -   å• SNP æ£®æ—å›¾å¯è¯†åˆ«å¼ºå½±å“çš„å·¥å…·ï¼ˆå†è¯„ä¼°å…¶ç”Ÿç‰©å­¦åˆç†æ€§æˆ–æ½œåœ¨å¤šæ•ˆæ€§ï¼‰ã€‚

![](plot-121.png)

![](plot-122.png)

![](plot-123.png)

![](plot-124.png)

## ä¸»åˆ†æç»“æœ

-   **IVWï¼ˆé€†æ–¹å·®åŠ æƒï¼‰** b = -0.0310ï¼ŒSE = 0.0150ï¼Œp = 0.038 â†’ è„‘å¹²ä½“ç§¯å¢åŠ ä¸æŠ‘éƒé£é™©é™ä½æ˜¾è‘—ç›¸å…³ã€‚

-   **åŠ æƒä¸­ä½æ•°ï¼ˆWeighted medianï¼‰** b = -0.0404ï¼ŒSE = 0.0152ï¼Œp = 0.008 â†’ ç»“æœæ–¹å‘ä¸€è‡´ï¼Œæ˜¾è‘—æ€§æ›´å¼ºï¼Œè¯´æ˜å³ä½¿éƒ¨åˆ†å·¥å…·æ— æ•ˆï¼Œç»“è®ºä»ç¨³å¥ã€‚

-   **MR-Eggerï¼ˆæ–œç‡ï¼‰** b = -0.0355ï¼ŒSE = 0.0489ï¼Œp = 0.468 â†’ æ–¹å‘ä¸€è‡´ï¼Œä½†ä¸æ˜¾è‘—ã€‚

-   **ç®€å•æ¨¡å¼ / åŠ æƒæ¨¡å¼** ç»“æœæ–¹å‘å¤§ä½“ä¸€è‡´ï¼Œä½†ä¸æ˜¾è‘—ã€‚

**ç»“è®º**ï¼šIVW ä¸åŠ æƒä¸­ä½æ•°å‡æç¤º **è„‘å¹²ä½“ç§¯è¶Šå¤§ï¼ŒæŠ‘éƒé£é™©è¶Šä½**ï¼Œä¸”ç»“æœæœ‰ç»Ÿè®¡å­¦æ„ä¹‰ã€‚

## äºŒã€æ•æ„Ÿæ€§åˆ†æ

-   **å¼‚è´¨æ€§ï¼ˆCochranâ€™s Qï¼‰** Q â‰ˆ 342ï¼Œdf â‰ˆ 122ï¼Œp \< 1e-22 â†’ å¼‚è´¨æ€§éå¸¸æ˜¾è‘—ï¼Œè¯´æ˜ä¸åŒ SNP çš„æ•ˆåº”å·®å¼‚è¾ƒå¤§ï¼Œå¯èƒ½å­˜åœ¨å¤šæ•ˆæ€§æˆ–æµ‹é‡è¯¯å·®ã€‚

-   **Egger æˆªè·** æˆªè· â‰ˆ 0.00025ï¼Œp = 0.923 â†’ æ²¡æœ‰æ–¹å‘æ€§æ°´å¹³å¤šæ•ˆæ€§çš„è¯æ®ï¼ˆå³å¹³å‡æ•ˆåº”ä¸åç§»ï¼‰ã€‚

**è§£è¯»**ï¼šè™½ç„¶å­˜åœ¨è¾ƒå¼ºå¼‚è´¨æ€§ï¼Œä½†æ²¡æœ‰å‘ç°æ–¹å‘æ€§å¤šæ•ˆæ€§ã€‚è¯´æ˜å¯èƒ½å­˜åœ¨â€œå¹³è¡¡å‹å¤šæ•ˆæ€§â€ï¼ŒIVW ç»“æœä»å¯è§£é‡Šï¼›åŠ æƒä¸­ä½æ•°çš„ç¨³å¥æ€§è¿›ä¸€æ­¥æ”¯æŒç»“è®ºã€‚

## ä¸‰ã€æ–¹å‘æ€§æ£€éªŒï¼ˆSteigerï¼‰

-   Steiger æ£€éªŒç”¨äºåˆ¤æ–­å› æœæ–¹å‘æ˜¯å¦ä¸º **è„‘å¹²ä½“ç§¯ â†’ æŠ‘éƒç—‡**ã€‚

-   è¿è¡Œä¸­å‡ºç°äº†æ•°æ®è¡Œæ•°ä¸åŒ¹é…çš„æç¤ºï¼Œéœ€è¦åœ¨æ•°æ®ä¸­æ·»åŠ å…ƒä¿¡æ¯ï¼ˆ`add_metadata()`ï¼‰åå†è¿è¡Œã€‚

-   å¦‚æœ Steiger è¿‡æ»¤åç»“æœä»ç„¶æ˜¾ç¤ºè´Ÿæ•ˆåº”å¹¶æ˜¾è‘—ï¼Œå°±æ›´èƒ½æ”¯æŒå› æœæ–¹å‘æ­£ç¡®ã€‚

## å››ã€å¯è§†åŒ–ç»“æœ

-   **æ•£ç‚¹å›¾**ï¼šæ˜¾ç¤ºå„æ–¹æ³•çš„å›å½’çº¿ï¼ŒIVW ä¸åŠ æƒä¸­ä½æ•°çº¿å‡ä¸ºè´Ÿæ–œç‡ã€‚

-   **ç•™ä¸€æ³•åˆ†æ**ï¼šç§»é™¤ä»»ä¸€ SNP åç»“æœç¨³å®šï¼Œè¯´æ˜ç»“è®ºä¸ä¾èµ–å•ä¸ªå·¥å…·ã€‚

-   **æ£®æ—å›¾**ï¼šå• SNP æ•ˆåº”æ–¹å‘å¤§ä½“ä¸€è‡´ï¼Œä½†æœ‰å°‘æ•° SNP æ•ˆåº”å·®å¼‚è¾ƒå¤§ã€‚

-   **æ¼æ–—å›¾**ï¼šæ•´ä½“å¯¹ç§°æ€§è¾ƒå¥½ï¼Œæœªè§æ˜æ˜¾å°æ ·æœ¬åå€šã€‚

## äº”ã€MR ä¸‰å¤§å‡è®¾æ˜¯å¦æ»¡è¶³

1.  **ç›¸å…³æ€§ï¼ˆRelevanceï¼‰**

    -   å·¥å…· SNP ä¸è„‘å¹²ä½“ç§¯æ˜¾è‘—ç›¸å…³ï¼ˆp \< 1e-5ï¼Œå·² clump å»é™¤ LDï¼‰ã€‚

    -   è¯´æ˜ç›¸å…³æ€§å‡è®¾æˆç«‹ã€‚

2.  **ç‹¬ç«‹æ€§ï¼ˆIndependenceï¼‰**

    -   å·¥å…· SNP ä¸æ··æ‚å› ç´ ç‹¬ç«‹ã€‚GWAS å·²æ ¡æ­£ç¾¤ä½“ç»“æ„ï¼Œclumping å‡å°‘ LDã€‚

    -   æ— æ³•å®Œå…¨è¯æ˜ï¼Œä½†ä¸€èˆ¬è®¤ä¸ºåˆç†ã€‚

3.  **æ’ä»–æ€§ï¼ˆExclusion restrictionï¼‰**

    -   å·¥å…· SNP ä»…é€šè¿‡è„‘å¹²ä½“ç§¯å½±å“æŠ‘éƒã€‚

    -   Egger æˆªè·ä¸æ˜¾è‘—ï¼Œè¯´æ˜æ²¡æœ‰æ–¹å‘æ€§æ°´å¹³å¤šæ•ˆæ€§ã€‚

    -   å¼‚è´¨æ€§æ˜¾è‘—ï¼Œæç¤ºå¯èƒ½å­˜åœ¨å¹³è¡¡å‹å¤šæ•ˆæ€§ï¼Œä½†åŠ æƒä¸­ä½æ•°ç»“æœä»ç¨³å¥ã€‚

    -   æ•´ä½“ä¸Šè¯¥å‡è®¾åŸºæœ¬æˆç«‹ã€‚

## å…­ã€æ€»ä½“ç»“è®º

-   **ä¸»è¦å‘ç°**ï¼šè„‘å¹²æ€»ä½“ä½“ç§¯å¢åŠ ä¸æŠ‘éƒç—‡é£é™©é™ä½å­˜åœ¨å› æœå…³è”ã€‚

-   **ç¨³å¥æ€§**ï¼šIVW ä¸åŠ æƒä¸­ä½æ•°ç»“æœä¸€è‡´ï¼ŒEgger æˆªè·ä¸æ˜¾è‘—ï¼Œç•™ä¸€æ³•åˆ†æç¨³å®šã€‚

-   **æ³¨æ„äº‹é¡¹**ï¼šå¼‚è´¨æ€§è¾ƒé«˜ï¼Œæç¤ºå¯èƒ½å­˜åœ¨å¤šæ•ˆæ€§æˆ–å·¥å…·æ•ˆåº”å·®å¼‚ï¼Œéœ€è¦è¿›ä¸€æ­¥æ•æ„Ÿæ€§åˆ†æï¼ˆå¦‚æ›´ä¸¥æ ¼çš„ p é˜ˆå€¼ã€MR-PRESSOï¼‰ã€‚

-   **æ–¹å‘æ€§**ï¼šéœ€è¡¥å…… Steiger æ£€éªŒç¡®è®¤å› æœæ–¹å‘ã€‚Steiger æ£€éªŒéœ€è¦çŸ¥é“æ¯ä¸ª GWAS çš„ **æ ·æœ¬é‡ (sample size)** å’Œ **æ•ˆåº”å€¼ (beta, se, maf)** æ¥è®¡ç®—æ–¹å·®è§£é‡Šåº¦.

------------------------------------------------------------------------

ä¸¤ä¸ªæ–‡ä»¶éƒ½æ˜¯ **åˆ¶è¡¨ç¬¦åˆ†éš”çš„æ–‡æœ¬æ–‡ä»¶** (`.txt`)ï¼Œ

### R ä»£ç ç¤ºä¾‹

```r
# è®¾ç½®å·¥ä½œç›®å½•
setwd("E:/acode/homwwork/data3")

# è¯»å– eQTL æ–‡ä»¶
eqtl <- read.table("eQTL.txt", header = TRUE, sep = "\t", stringsAsFactors = FALSE)

# è¯»å– GWAS æ–‡ä»¶
gwas <- read.table("GWAS_EUR_atrial fibrillation_chr6.txt", header = TRUE, sep = "\t", stringsAsFactors = FALSE)

# æŸ¥çœ‹å‰å‡ è¡Œå’Œåˆ—å
head(eqtl)
colnames(eqtl)

head(gwas)
colnames(gwas)
```

``` r
+ head(eqtl)
+ colnames(eqtl)
+ 
+ head(gwas)
+ colnames(gwas)
            gene_id     gene_name gene_chr gene_start gene_end
1 ENSG00000227232.5        WASH7P     chr1      14410    29553
2 ENSG00000240361.1       OR4G11P     chr1      62948    63887
3 ENSG00000186092.4         OR4F5     chr1      69091    70008
4 ENSG00000268903.1 RP11-34P13.15     chr1     135141   135895
5 ENSG00000269981.1 RP11-34P13.16     chr1     137682   137965
6 ENSG00000279457.4 RP11-34P13.18     chr1     185217   195411
  strand num_var beta_shape1 beta_shape2 true_df pval_true_df
1      -    1364     1.01157     280.800 282.379  8.38906e-07
2      +    1520     1.01235     326.604 289.739  3.59265e-03
3      +    1541     1.01869     326.003 287.455  9.05523e-05
4      -    1863     1.03811     353.346 282.101  6.61052e-04
5      -    1868     1.05087     334.272 277.796  2.78135e-04
6      -    2234     1.04471     378.207 275.991  3.42677e-04
            variant_id tss_distance  chr variant_pos ref alt
1  chr1_665098_G_A_b38       635545 chr1      665098   G   A
2  chr1_665098_G_A_b38       602150 chr1      665098   G   A
3  chr1_807641_T_C_b38       738550 chr1      807641   T   C
4  chr1_986007_G_A_b38       850112 chr1      986007   G   A
5 chr1_1028281_C_T_b38       890316 chr1     1028281   C   T
6  chr1_665098_G_A_b38       469687 chr1      665098   G   A
  num_alt_per_site rs_id_dbSNP151_GRCh38p7 minor_allele_samples
1                1             rs114979547                   91
2                1             rs114979547                   91
3                1               rs3964475                  171
4                1             rs115014500                    8
5                1              rs13303147                   28
6                1             rs114979547                   91
  minor_allele_count       maf ref_factor pval_nominal
1                 94 0.1217620          1  1.87224e-07
2                 94 0.1217620          1  2.35641e-03
3                195 0.2525910          1  4.04856e-05
4                  8 0.0103627          1  3.12900e-04
5                 29 0.0375648          1  1.05679e-04
6                 94 0.1217620          1  1.27160e-04
      slope  slope_se  pval_perm   pval_beta        qval
1  0.403338 0.0756735 0.00029997 0.000212786 0.000311193
2 -0.259344 0.0845860 0.69273400 0.686484000 0.286310000
3  0.291123 0.0699246 0.02639740 0.027016300 0.025012700
4 -0.900366 0.2470360 0.19635200 0.193477000 0.120630000
5 -0.587608 0.1496360 0.07449260 0.076866200 0.059863200
6  0.340850 0.0878486 0.10648900 0.108665000 0.078511000
  pval_nominal_threshold  log2_aFC log2_aFC_lower
1            0.000235891  0.697958       0.513705
2            0.000203324 -0.775033      -1.281557
3            0.000207882  0.932644       0.649848
4            0.000203850 -6.643856      -6.643856
5            0.000224046 -1.615290      -6.094829
6            0.000194351  0.401163       0.248050
  log2_aFC_upper
1       0.873141
2      -0.473808
3       1.331262
4      -6.643856
5      -1.119854
6       0.612973
 [1] "gene_id"                 "gene_name"              
 [3] "gene_chr"                "gene_start"             
 [5] "gene_end"                "strand"                 
 [7] "num_var"                 "beta_shape1"            
 [9] "beta_shape2"             "true_df"                
[11] "pval_true_df"            "variant_id"             
[13] "tss_distance"            "chr"                    
[15] "variant_pos"             "ref"                    
[17] "alt"                     "num_alt_per_site"       
[19] "rs_id_dbSNP151_GRCh38p7" "minor_allele_samples"   
[21] "minor_allele_count"      "maf"                    
[23] "ref_factor"              "pval_nominal"           
[25] "slope"                   "slope_se"               
[27] "pval_perm"               "pval_beta"              
[29] "qval"                    "pval_nominal_threshold" 
[31] "log2_aFC"                "log2_aFC_lower"         
[33] "log2_aFC_upper"         
  chromosome base_pair_location effect_allele other_allele
1          6          139325608             t            c
2          6          132527427             t            g
3          6           12945597             t            c
4          6          154485321             t            c
5          6           32636331             t            c
6          6          168094046             t            c
     beta standard_error effect_allele_frequency p_value
1  0.2324         0.3667                  0.0003  0.5262
2 -0.2293         0.2968                  0.0002  0.4399
3  0.1782         0.4510                  0.0002  0.6928
4 -0.0131         0.0202                  0.9867  0.5173
5 -0.0068         0.0046                  0.6868  0.1398
6 -0.0820         0.0973                  0.9994  0.3992
        rs_id       n
1 rs540184302  444676
2              316342
3 rs115357758  444676
4  rs78948046 1840340
5   rs9272319 1840340
6 rs115699353 1079770
 [1] "chromosome"              "base_pair_location"     
 [3] "effect_allele"           "other_allele"           
 [5] "beta"                    "standard_error"         
 [7] "effect_allele_frequency" "p_value"                
 [9] "rs_id"  
```

## ğŸ§¾ æ•°æ®æ ¼å¼æ€»ç»“

-   **GWAS æ–‡ä»¶ (**`GWAS_EUR_atrial fibrillation_chr6.txt`**)**

    -   å…³é”®åˆ—ï¼š`chromosome`, `base_pair_location`, `rs_id`, `beta`, `standard_error`, `effect_allele_frequency`, `p_value`

    -   ç”¨äºå®šä½æ˜¾è‘— SNP åŠå…¶æ•ˆåº”å€¼ã€‚

-   **eQTL æ–‡ä»¶ (**`eQTL.txt`**)**

    -   å…³é”®åˆ—ï¼š`gene_id`, `gene_name`, `chr`, `variant_pos`, `rs_id_dbSNP151_GRCh38p7`, `maf`, `pval_nominal`, `slope`, `slope_se`

    -   ç”¨äºåŸºå› è¡¨è¾¾è°ƒæ§ä¿¡å·ã€‚

## ğŸ§¬ åˆ†ææ­¥éª¤

### 1. ç¡®è®¤ GWAS æ˜¾è‘—ä½ç‚¹

```r
# è¯»å– GWAS æ–‡ä»¶
gwas <- read.table("E:/acode/homwwork/data3/GWAS_EUR_atrial fibrillation_chr6.txt", 
                   header = TRUE, sep = "\t", stringsAsFactors = FALSE)

# æŸ¥çœ‹ rs7742789 çš„ä¿¡æ¯
gwas[gwas$rs_id == "rs7742789", ]
```

### 

### 1. ç¡®è®¤ GWAS ä½ç‚¹åæ ‡

```r
gwas[gwas$rs_id == "rs7742789", c("chromosome","base_pair_location")]
```

ğŸ‘‰ æ‰“å°å‡º rs7742789 çš„åæ ‡ã€‚

``` r
       nsnps    PP.H0.abf    PP.H1.abf    PP.H2.abf 
1.000000e+00 1.606210e-05 1.986290e-02 7.925723e-07 
   PP.H3.abf    PP.H4.abf 
0.000000e+00 9.801202e-01 
> gwas[gwas$rs_id == "rs7742789", c("chromosome","base_pair_location")]
        chromosome base_pair_location
1220693          6           43378065
```

### 2. æŸ¥çœ‹ eQTL æ–‡ä»¶æ˜¯å¦è¦†ç›–è¯¥æŸ“è‰²ä½“èŒƒå›´

```r
eqtl_chr6 <- eqtl %>% filter(chr == "chr6")
range(eqtl_chr6$variant_pos)
 
```

``` r

[1]    348124 170578141
```

ğŸ‘‰ çœ‹çœ‹ eQTL æ–‡ä»¶çš„ chr6 SNP èŒƒå›´ï¼Œæ˜¯å¦åŒ…å« rs7742789 çš„ä½ç½®ã€‚

### 3. ç›´æ¥æœç´¢ rs7742789 æ˜¯å¦å­˜åœ¨äº eQTL

```r
eqtl[eqtl$rs_id_dbSNP151_GRCh38p7 == "rs7742789", ] 
```

``` r
[1]    348124 170578141
> eqtl[eqtl$rs_id_dbSNP151_GRCh38p7 == "rs7742789", ] 
                gene_id gene_name gene_chr gene_start gene_end
7011 ENSG00000124574.14    ABCC10     chr6   43427366 43450351
     strand num_var beta_shape1 beta_shape2 true_df
7011      +    6441     1.04838     1006.43 283.659
     pval_true_df            variant_id tss_distance  chr
7011  2.96772e-05 chr6_43378065_C_T_b38       -49301 chr6
     variant_pos ref alt num_alt_per_site
7011    43378065   C   T                1
     rs_id_dbSNP151_GRCh38p7 minor_allele_samples
7011               rs7742789                  207
     minor_allele_count      maf ref_factor pval_nominal
7011                256 0.331606          1  1.04352e-05
         slope  slope_se pval_perm pval_beta      qval
7011 -0.139377 0.0311093 0.0233977 0.0243006 0.0228507
     pval_nominal_threshold  log2_aFC log2_aFC_lower
7011            7.38637e-05 -0.089235      -0.114012
     log2_aFC_upper
7011      -0.051075
```

å·²ç»ç¡®è®¤äº† **rs7742789** åœ¨ GWAS å’Œ eQTL æ–‡ä»¶é‡Œéƒ½å­˜åœ¨ï¼Œè€Œä¸”åæ ‡å®Œå…¨ä¸€è‡´ (`chr6:43378065`)ã€‚

## âœ… ä¸‹ä¸€æ­¥æ“ä½œ

æˆ‘ä»¬å¯ä»¥åˆ†æˆå‡ ä¸ªå°æ­¥éª¤æ¥æ„å»ºè¾“å…¥å¹¶è¿è¡Œ colocï¼š

### 1. æå– GWAS SNP ä¿¡æ¯

```r
gwas_snp <- gwas %>%
  filter(rs_id == "rs7742789") %>%
  mutate(effect_allele_frequency = as.numeric(effect_allele_frequency)) %>%
  filter(!is.na(effect_allele_frequency),
         effect_allele_frequency > 0,
         effect_allele_frequency < 1)

gwas_snp

```

``` r
  chromosome base_pair_location effect_allele other_allele
1          6           43378065             t            c
    beta standard_error effect_allele_frequency   p_value
1 0.0241         0.0037                  0.2993 1.124e-10
      rs_id       n
1 rs7742789 1840340
```

### 2. æå– eQTL SNP ä¿¡æ¯

```r
eqtl_snp <- eqtl %>%
  filter(rs_id_dbSNP151_GRCh38p7 == "rs7742789") %>%
  mutate(maf = as.numeric(maf)) %>%
  filter(!is.na(maf), maf > 0, maf < 1)

eqtl_snp

```

```r
            gene_id gene_name gene_chr gene_start gene_end
1 ENSG00000124574.14    ABCC10     chr6   43427366 43450351
  strand num_var beta_shape1 beta_shape2 true_df pval_true_df
1      +    6441     1.04838     1006.43 283.659  2.96772e-05
             variant_id tss_distance  chr variant_pos ref alt
1 chr6_43378065_C_T_b38       -49301 chr6    43378065   C   T
  num_alt_per_site rs_id_dbSNP151_GRCh38p7 minor_allele_samples
1                1               rs7742789                  207
  minor_allele_count      maf ref_factor pval_nominal     slope
1                256 0.331606          1  1.04352e-05 -0.139377
   slope_se pval_perm pval_beta      qval
1 0.0311093 0.0233977 0.0243006 0.0228507
  pval_nominal_threshold  log2_aFC log2_aFC_lower
1            7.38637e-05 -0.089235      -0.114012
  log2_aFC_upper
1      -0.051075
```

### 3. æ„å»º coloc è¾“å…¥

```r
library(coloc)

# GWAS è¾“å…¥
gwas_input <- list(
  beta = gwas_snp$beta,
  varbeta = gwas_snp$standard_error^2,
  snp = gwas_snp$rs_id,
  MAF = gwas_snp$effect_allele_frequency,
  N = gwas_snp$n,
  type = "quant"
)

# eQTL è¾“å…¥
eqtl_input <- list(
  beta = eqtl_snp$slope,
  varbeta = eqtl_snp$slope_se^2,
  snp = eqtl_snp$rs_id_dbSNP151_GRCh38p7,
  MAF = eqtl_snp$maf,
  N = 207,   # è¿™é‡Œç”¨ eQTL æ–‡ä»¶é‡Œçš„ minor_allele_samples è¿‘ä¼¼ä»£æ›¿æ€»æ ·æœ¬é‡
  type = "quant"
)

```

### 4. è¿è¡Œ coloc

```r
res <- coloc.abf(dataset1 = gwas_input, dataset2 = eqtl_input) 
print(res$summary) 
```

``` r
       nsnps    PP.H0.abf    PP.H1.abf    PP.H2.abf 
1.000000e+00 1.606210e-05 1.986290e-02 7.925723e-07 
   PP.H3.abf    PP.H4.abf 
0.000000e+00 9.801202e-01 
```

## ğŸ“Š coloc è¾“å‡ºç»“æœ

-   **nsnps = 1** â†’ è¯´æ˜åœ¨è¾“å…¥çš„æ•°æ®é‡Œï¼ŒGWAS å’Œ eQTL åªæœ‰ä¸€ä¸ªäº¤é›† SNPï¼ˆå°±æ˜¯ rs7742789ï¼‰ã€‚

-   **PP.H0.abf = 1.6e-05** â†’ æ— å…³è”çš„æ¦‚ç‡ï¼Œéå¸¸ä½ã€‚

-   **PP.H1.abf = 0.0199 (\~2%)** â†’ ä»… GWAS å…³è”çš„æ¦‚ç‡ã€‚

-   **PP.H2.abf = 7.9e-07 (\~0%)** â†’ ä»… eQTL å…³è”çš„æ¦‚ç‡ã€‚

-   **PP.H3.abf = 0** â†’ ä¸¤è€…å…³è”ä½†ä¸åŒå› æœå˜å¼‚çš„æ¦‚ç‡ã€‚

-   **PP.H4.abf = 0.980 (\~98%)** â†’ ä¸¤è€…å…±å®šä½çš„æ¦‚ç‡ï¼Œéå¸¸é«˜ã€‚

## âœ… ç»“æœè§£è¯»

-   æˆ‘ä»¬çš„åˆ†æè¡¨æ˜ï¼š**rs7742789 çš„ GWAS ä¿¡å·ä¸ ABCC10 åŸºå› çš„ eQTL ä¿¡å·é«˜åº¦å…±å®šä½**ã€‚

-   PP4 æ¥è¿‘ 1ï¼Œè¯´æ˜å‡ ä¹å¯ä»¥ç¡®å®šè¿™ä¸ª GWAS ä½ç‚¹çš„åŠŸèƒ½è§£é‡Šå°±æ˜¯é€šè¿‡å½±å“ **ABCC10 åŸºå› çš„è¡¨è¾¾**ã€‚

-   è¿™æ˜¯ä¸€ç§å¼ºæœ‰åŠ›çš„è¯æ®ï¼Œæç¤º ABCC10 å¯èƒ½å‚ä¸æˆ¿é¢¤çš„é—ä¼ æœºåˆ¶ã€‚